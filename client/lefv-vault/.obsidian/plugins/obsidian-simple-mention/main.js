/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var bt=Object.defineProperty,Ss=Object.defineProperties,Es=Object.getOwnPropertyDescriptor,Os=Object.getOwnPropertyDescriptors,Ts=Object.getOwnPropertyNames,hn=Object.getOwnPropertySymbols;var dn=Object.prototype.hasOwnProperty,_s=Object.prototype.propertyIsEnumerable;var pn=(n,e,t)=>e in n?bt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,K=(n,e)=>{for(var t in e||(e={}))dn.call(e,t)&&pn(n,t,e[t]);if(hn)for(var t of hn(e))_s.call(e,t)&&pn(n,t,e[t]);return n},Y=(n,e)=>Ss(n,Os(e));var Fe=(n,e)=>()=>(n&&(e=n(n=0)),e);var ai=(n,e)=>{for(var t in e)bt(n,t,{get:e[t],enumerable:!0})},As=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ts(e))!dn.call(n,s)&&s!==t&&bt(n,s,{get:()=>e[s],enumerable:!(i=Es(e,s))||i.enumerable});return n};var li=n=>As(bt({},"__esModule",{value:!0}),n);var D=(n,e,t)=>new Promise((i,s)=>{var r=l=>{try{a(t.next(l))}catch(c){s(c)}},o=l=>{try{a(t.throw(l))}catch(c){s(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(r,o);a((t=t.apply(n,e)).next())});var Ae,ds=Fe(()=>{Ae=class{static convertToBoolean(e,t=!1){return e===!0||e==="true"?e=!0:e===!1||e==="false"?e=!1:e=t,e}static removeArrayEmpty(e){return!Array.isArray(e)||!e.length?[]:e.filter(t=>!!t)}static throttle(e,t){let i=0,s;return(...r)=>{let o=new Date().getTime(),a=t-(o-i);clearTimeout(s),a<=0?(i=o,e(...r)):s=setTimeout(()=>{e(...r)},a)}}}});var H,fs=Fe(()=>{ln();H=class{static addClass(e,t){!e||(t=t.split(" "),H.getElements(e).forEach(i=>{i.classList.add(...t)}))}static removeClass(e,t){!e||(t=t.split(" "),H.getElements(e).forEach(i=>{i.classList.remove(...t)}))}static hasClass(e,t){return e?e.classList.contains(t):!1}static getElement(e){return e&&(typeof e=="string"?e=document.querySelector(e):e.length!==void 0&&(e=e[0])),e||null}static getElements(e){if(!!e)return e.forEach===void 0&&(e=[e]),e}static addEvent(e,t,i){H.addOrRemoveEvent(e,t,i,"add")}static removeEvent(e,t,i){H.addOrRemoveEvent(e,t,i,"remove")}static addOrRemoveEvent(e,t,i,s){!e||(t=Ae.removeArrayEmpty(t.split(" ")),t.forEach(r=>{e=H.getElements(e),e.forEach(o=>{s==="add"?o.addEventListener(r,i):o.removeEventListener(r,i)})}))}static getScrollableParents(e){if(!e)return[];let t=[window],i=e.parentElement;for(;i;){let s=getComputedStyle(i).overflow;(s.indexOf("scroll")!==-1||s.indexOf("auto")!==-1)&&t.push(i),i=i.parentElement}return t}static convertPropToDataAttr(e){return e?`data-popover-${e}`.replace(/([A-Z])/g,"-$1").toLowerCase():""}}});var ln=Fe(()=>{ds();fs()});var ms={};ai(ms,{PopoverComponent:()=>re});var ao,lo,cn,re,gs=Fe(()=>{ln();ao={27:"onEscPress"},lo=["target","position","margin","offset","enterDelay","exitDelay","showDuration","hideDuration","transitionDistance","updatePositionThrottle","zIndex","hideOnOuterClick","showOnHover","hideArrowIcon","disableManualAction","disableUpdatePosition"],re=class{constructor(e){try{this.setProps(e),this.init()}catch(t){console.warn("Couldn't initiate Popover component"),console.error(t)}}init(){!this.$popover||(this.setElementProps(),this.renderArrow(),this.initPopper(),this.addEvents())}getEvents(){let e=[{$ele:document,event:"click",method:"onDocumentClick"},{$ele:document,event:"keydown",method:"onDocumentKeyDown"}];return this.disableManualAction||(e.push({$ele:this.$ele,event:"click",method:"onTriggerEleClick"}),this.showOnHover&&(e.push({$ele:this.$ele,event:"mouseenter",method:"onTriggerEleMouseEnter"}),e.push({$ele:this.$ele,event:"mouseleave",method:"onTriggerEleMouseLeave"}))),e}addOrRemoveEvents(e){this.getEvents().forEach(i=>{this.addOrRemoveEvent({action:e,$ele:i.$ele,events:i.event,method:i.method})})}addEvents(){this.addOrRemoveEvents("add")}removeEvents(){this.addOrRemoveEvents("remove"),this.removeScrollEventListeners()}addOrRemoveEvent({action:e,$ele:t,events:i,method:s,throttle:r}){!t||(i=Ae.removeArrayEmpty(i.split(" ")),i.forEach(o=>{let a=`${s}-${o}`,l=this.events[a];l||(l=this[s].bind(this),r&&(l=Ae.throttle(l,r)),this.events[a]=l),e==="add"?H.addEvent(t,o,l):H.removeEvent(t,o,l)}))}addScrollEventListeners(){this.$scrollableElems=H.getScrollableParents(this.$ele),this.addOrRemoveEvent({action:"add",$ele:this.$scrollableElems,events:"scroll",method:"onAnyParentScroll",throttle:this.updatePositionThrottle})}removeScrollEventListeners(){!this.$scrollableElems||(this.addOrRemoveEvent({action:"remove",$ele:this.$scrollableElems,events:"scroll",method:"onAnyParentScroll"}),this.$scrollableElems=null)}onAnyParentScroll(){this.popper.updatePosition()}onDocumentClick(e){let t=e.target,i=t.closest(".pop-comp-ele"),s=t.closest(".pop-comp-wrapper");this.hideOnOuterClick&&i!==this.$ele&&s!==this.$popover&&this.hide()}onDocumentKeyDown(e){let t=e.which||e.keyCode,i=ao[t];i&&this[i](e)}onEscPress(){this.hideOnOuterClick&&this.hide()}onTriggerEleClick(){this.toggle()}onTriggerEleMouseEnter(){this.show()}onTriggerEleMouseLeave(){this.hide()}setProps(e){e=this.setDefaultProps(e),this.setPropsFromElementAttr(e);let t=Ae.convertToBoolean;this.$ele=e.ele,this.target=e.target,this.position=e.position,this.margin=parseFloat(e.margin),this.offset=parseFloat(e.offset),this.enterDelay=parseFloat(e.enterDelay),this.exitDelay=parseFloat(e.exitDelay),this.showDuration=parseFloat(e.showDuration),this.hideDuration=parseFloat(e.hideDuration),this.transitionDistance=parseFloat(e.transitionDistance),this.updatePositionThrottle=parseFloat(e.updatePositionThrottle),this.zIndex=parseFloat(e.zIndex),this.hideOnOuterClick=t(e.hideOnOuterClick),this.showOnHover=t(e.showOnHover),this.hideArrowIcon=t(e.hideArrowIcon),this.disableManualAction=t(e.disableManualAction),this.disableUpdatePosition=t(e.disableUpdatePosition),this.beforeShowCallback=e.beforeShow,this.afterShowCallback=e.afterShow,this.beforeHideCallback=e.beforeHide,this.afterHideCallback=e.afterHide,this.events={},this.$popover=H.getElement(this.target)}setDefaultProps(e){return Object.assign({position:"auto",margin:8,offset:5,enterDelay:0,exitDelay:0,showDuration:300,hideDuration:200,transitionDistance:10,updatePositionThrottle:100,zIndex:1,hideOnOuterClick:!0,showOnHover:!1,hideArrowIcon:!1,disableManualAction:!1,disableUpdatePosition:!1},e)}setPropsFromElementAttr(e){let t=e.ele;for(let i in cn){let s=t.getAttribute(i);s&&(e[cn[i]]=s)}}setElementProps(){let e=this.$ele;e.popComp=this,e.show=re.showMethod,e.hide=re.hideMethod,e.updatePosition=re.updatePositionMethod,H.addClass(this.$ele,"pop-comp-ele"),H.addClass(this.$popover,"pop-comp-wrapper")}getOtherTriggerPopComp(){let e=this.$popover.popComp,t;return e&&e.$ele!==this.$ele&&(t=e),t}initPopper(){let e={$popperEle:this.$popover,$triggerEle:this.$ele,$arrowEle:this.$arrowEle,position:this.position,margin:this.margin,offset:this.offset,enterDelay:this.enterDelay,exitDelay:this.exitDelay,showDuration:this.showDuration,hideDuration:this.hideDuration,transitionDistance:this.transitionDistance,zIndex:this.zIndex,afterShow:this.afterShow.bind(this),afterHide:this.afterHide.bind(this)};this.popper=new PopperComponent(e)}beforeShow(){typeof this.beforeShowCallback=="function"&&this.beforeShowCallback(this)}beforeHide(){typeof this.beforeHideCallback=="function"&&this.beforeHideCallback(this)}show(){if(!this.isShown()){if(this.isShownForOtherTrigger()){this.showAfterOtherHide();return}H.addClass(this.$popover,"pop-comp-disable-events"),this.$popover.popComp=this,this.beforeShow(),this.popper.show({resetPosition:!0}),H.addClass(this.$ele,"pop-comp-active")}}hide(){!this.isShown()||(this.beforeHide(),this.popper.hide(),this.removeScrollEventListeners())}toggle(e){e===void 0&&(e=!this.isShown()),e?this.show():this.hide()}isShown(){return H.hasClass(this.$ele,"pop-comp-active")}isShownForOtherTrigger(){let e=this.getOtherTriggerPopComp();return e?e.isShown():!1}showAfterOtherHide(){let e=this.getOtherTriggerPopComp();if(!e)return;let t=e.exitDelay+e.hideDuration+100;setTimeout(()=>{this.show()},t)}afterShow(){this.showOnHover?setTimeout(()=>{H.removeClass(this.$popover,"pop-comp-disable-events")},2e3):H.removeClass(this.$popover,"pop-comp-disable-events"),this.disableUpdatePosition||this.addScrollEventListeners(),typeof this.afterShowCallback=="function"&&this.afterShowCallback(this)}afterHide(){H.removeClass(this.$ele,"pop-comp-active"),typeof this.afterHideCallback=="function"&&this.afterHideCallback(this)}renderArrow(){if(this.hideArrowIcon)return;let e=this.$popover.querySelector(".pop-comp-arrow");e||(this.$popover.insertAdjacentHTML("afterbegin",'<i class="pop-comp-arrow"></i>'),e=this.$popover.querySelector(".pop-comp-arrow")),this.$arrowEle=e}destroy(){this.removeEvents()}static init(e){let t=e.ele;if(!t)return;let i=!1;if(typeof t=="string"){if(t=document.querySelectorAll(t),!t)return;t.length===1&&(i=!0)}t.length===void 0&&(t=[t],i=!0);let s=[];return t.forEach(r=>{e.ele=r,re.destroy(r),s.push(new re(e))}),i?s[0]:s}static destroy(e){if(!e)return;let t=e.popComp;t&&t.destroy()}static showMethod(){this.popComp.show()}static hideMethod(){this.popComp.hide()}static updatePositionMethod(){this.popComp.popper.updatePosition()}static getAttrProps(){let{convertPropToDataAttr:e}=H,t={};return lo.forEach(i=>{t[e(i)]=i}),t}};cn=re.getAttrProps();window.PopoverComponent=re});var k,vs=Fe(()=>{k=class{static addClass(e,t){!e||(t=t.split(" "),k.getElements(e).forEach(i=>{i.classList.add(...t)}))}static removeClass(e,t){!e||(t=t.split(" "),k.getElements(e).forEach(i=>{i.classList.remove(...t)}))}static getElements(e){if(!!e)return e.forEach===void 0&&(e=[e]),e}static getMoreVisibleSides(e){if(!e)return{};let t=e.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,r=t.left,o=t.top,a=i-r-t.width,l=s-o-t.height,c=r>a?"left":"right",h=o>l?"top":"bottom";return{horizontal:c,vertical:h}}static getAbsoluteCoords(e){if(!e)return;let t=e.getBoundingClientRect(),i=window.pageXOffset,s=window.pageYOffset;return{width:t.width,height:t.height,top:t.top+s,right:t.right+i,bottom:t.bottom+s,left:t.left+i}}static getCoords(e){return e?e.getBoundingClientRect():{}}static getData(e,t,i){if(!e)return;let s=e?e.dataset[t]:"";return i==="number"?s=parseFloat(s)||0:s==="true"?s=!0:s==="false"&&(s=!1),s}static setData(e,t,i){!e||(e.dataset[t]=i)}static setStyle(e,t,i){!e||(e.style[t]=i)}static show(e,t="block"){k.setStyle(e,"display",t)}static hide(e){k.setStyle(e,"display","none")}static getHideableParent(e){let t,i=e.parentElement;for(;i;){let s=getComputedStyle(i).overflow;if(s.indexOf("scroll")!==-1||s.indexOf("auto")!==-1){t=i;break}i=i.parentElement}return t}}});var ys={};ai(ys,{Popper:()=>ei});var co,uo,ho,ei,bs=Fe(()=>{vs();co=["top","bottom","left","right"],uo=co.map(n=>`position-${n}`),ho={top:"rotate(180deg)",left:"rotate(90deg)",right:"rotate(-90deg)"},ei=class{constructor(e){try{this.setProps(e),this.init()}catch(t){console.warn("Couldn't initiate popper"),console.error(t)}}init(){let e=this.$popperEle;!e||!this.$triggerEle||(k.setStyle(e,"zIndex",this.zIndex),this.setPosition())}setProps(e){e=this.setDefaultProps(e);let t=e.position?e.position.toLowerCase():"auto";if(this.$popperEle=e.$popperEle,this.$triggerEle=e.$triggerEle,this.$arrowEle=e.$arrowEle,this.margin=parseFloat(e.margin),this.offset=parseFloat(e.offset),this.enterDelay=parseFloat(e.enterDelay),this.exitDelay=parseFloat(e.exitDelay),this.showDuration=parseFloat(e.showDuration),this.hideDuration=parseFloat(e.hideDuration),this.transitionDistance=parseFloat(e.transitionDistance),this.zIndex=parseFloat(e.zIndex),this.afterShowCallback=e.afterShow,this.afterHideCallback=e.afterHide,this.hasArrow=!!this.$arrowEle,t.indexOf(" ")!==-1){let i=t.split(" ");this.position=i[0],this.secondaryPosition=i[1]}else this.position=t}setDefaultProps(e){return Object.assign({position:"auto",margin:8,offset:5,enterDelay:0,exitDelay:0,showDuration:300,hideDuration:200,transitionDistance:10,zIndex:1},e)}setPosition(){k.show(this.$popperEle,"inline-flex");let e=window.innerWidth,t=window.innerHeight,i=k.getAbsoluteCoords(this.$popperEle),s=k.getAbsoluteCoords(this.$triggerEle),r=i.width,o=i.height,a=i.top,l=i.right,c=i.bottom,h=i.left,p=s.width,d=s.height,u=s.top,v=s.right,m=s.bottom,y=s.left,g=u-a,C=y-h,b=C,f=g,w=this.position,S=this.secondaryPosition,O=p/2-r/2,T=d/2-o/2,P=this.margin,$=this.transitionDistance,I,B,M=window.scrollY-a,Q=t+M,z=window.scrollX-h,j=e+z,W,L=this.offset;L&&(M+=L,Q-=L,z+=L,j-=L),w==="auto"&&(w=k.getMoreVisibleSides(this.$triggerEle).vertical);let we={top:{top:f-o-P,left:b+O},bottom:{top:f+d+P,left:b+O},right:{top:f+T,left:b+p+P},left:{top:f+T,left:b-r-P}},yt=we[w];if(f=yt.top,b=yt.left,S&&(S==="top"?f=g:S==="bottom"?f=g+d-o:S==="left"?b=C:S==="right"&&(b=C+p-r)),b<z?w==="left"?W="right":z+h>v?b=v-h:b=z:b+r>j&&(w==="right"?W="left":j+h<y?b=y-l:b=j-r),f<M?w==="top"?W="bottom":M+a>m?f=m-a:f=M:f+o>Q&&(w==="bottom"?W="top":Q+a<u?f=u-c:f=Q-o),W){let U=we[W];w=W,w==="top"||w==="bottom"?f=U.top:(w==="left"||w==="right")&&(b=U.left)}w==="top"?(I=f+$,B=b):w==="right"?(I=f,B=b-$):w==="left"?(I=f,B=b+$):(I=f-$,B=b);let Xe=`translate3d(${B}px, ${I}px, 0)`;if(k.setStyle(this.$popperEle,"transform",Xe),k.setData(this.$popperEle,"fromLeft",B),k.setData(this.$popperEle,"fromTop",I),k.setData(this.$popperEle,"top",f),k.setData(this.$popperEle,"left",b),k.removeClass(this.$popperEle,uo.join(" ")),k.addClass(this.$popperEle,`position-${w}`),this.hasArrow){let U=0,ue=0,oi=b+h,ws=f+a,xe=this.$arrowEle.offsetWidth/2,xs=ho[w]||"";w==="top"||w==="bottom"?(U=p/2+y-oi,U<xe?U=xe:U>r-xe&&(U=r-xe)):(w==="left"||w==="right")&&(ue=d/2+u-ws,ue<xe?ue=xe:ue>o-xe&&(ue=o-xe)),k.setStyle(this.$arrowEle,"transform",`translate3d(${U}px, ${ue}px, 0) ${xs}`)}k.hide(this.$popperEle)}resetPosition(){k.setStyle(this.$popperEle,"transform","none"),this.setPosition()}show({resetPosition:e,data:t}={}){clearTimeout(this.exitDelayTimeout),clearTimeout(this.hideDurationTimeout),e&&this.resetPosition(),this.enterDelayTimeout=setTimeout(()=>{let i=k.getData(this.$popperEle,"left"),s=k.getData(this.$popperEle,"top"),r=`translate3d(${i}px, ${s}px, 0)`,o=this.showDuration;k.show(this.$popperEle,"inline-flex"),k.getCoords(this.$popperEle),k.setStyle(this.$popperEle,"transitionDuration",o+"ms"),k.setStyle(this.$popperEle,"transform",r),k.setStyle(this.$popperEle,"opacity",1),this.showDurationTimeout=setTimeout(()=>{typeof this.afterShowCallback=="function"&&this.afterShowCallback(t)},o)},this.enterDelay)}hide({data:e}={}){clearTimeout(this.enterDelayTimeout),clearTimeout(this.showDurationTimeout),this.exitDelayTimeout=setTimeout(()=>{if(this.$popperEle){let t=k.getData(this.$popperEle,"fromLeft"),i=k.getData(this.$popperEle,"fromTop"),s=`translate3d(${t}px, ${i}px, 0)`,r=this.hideDuration;k.setStyle(this.$popperEle,"transitionDuration",r+"ms"),k.setStyle(this.$popperEle,"transform",s),k.setStyle(this.$popperEle,"opacity",0),this.hideDurationTimeout=setTimeout(()=>{k.hide(this.$popperEle),typeof this.afterHideCallback=="function"&&this.afterHideCallback(e)},r)}},this.exitDelay)}updatePosition(){k.setStyle(this.$popperEle,"transitionDuration","0ms"),this.resetPosition();let e=k.getData(this.$popperEle,"left"),t=k.getData(this.$popperEle,"top");k.show(this.$popperEle,"inline-flex"),k.setStyle(this.$popperEle,"transform",`translate3d(${e}px, ${t}px, 0)`)}};window.PopperComponent=ei});var po={};ai(po,{default:()=>si});module.exports=li(po);var ri=require("obsidian");var ls=require("@codemirror/state");var mo=new Error("timeout while waiting for mutex to become available"),go=new Error("mutex already locked"),Ms=new Error("request for lock canceled"),fn=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(p){o(p)}}function l(h){try{c(i.throw(h))}catch(p){o(p)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},ci=class{constructor(e,t=Ms){if(this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){let e=this.isLocked(),t=new Promise((i,s)=>this._queue.push({resolve:i,reject:s}));return e||this._dispatch(),t}runExclusive(e){return fn(this,void 0,void 0,function*(){let[t,i]=yield this.acquire();try{return yield e(t)}finally{i()}})}waitForUnlock(){return fn(this,void 0,void 0,function*(){return this.isLocked()?new Promise(t=>this._waiters.push({resolve:t})):Promise.resolve()})}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){let e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatch(){let e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach(e=>e.resolve()),this._waiters=[]}},Ds=function(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(p){o(p)}}function l(h){try{c(i.throw(h))}catch(p){o(p)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((i=i.apply(n,e||[])).next())})},wt=class{constructor(e){this._semaphore=new ci(1,e)}acquire(){return Ds(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var vt=require("obsidian");var N=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,G=Object.keys,Z=Array.isArray;typeof Promise!="undefined"&&!N.Promise&&(N.Promise=Promise);function te(n,e){return typeof e!="object"||G(e).forEach(function(t){n[t]=e[t]}),n}var it=Object.getPrototypeOf,Ps={}.hasOwnProperty;function ne(n,e){return Ps.call(n,e)}function We(n,e){typeof e=="function"&&(e=e(it(n))),(typeof Reflect=="undefined"?G:Reflect.ownKeys)(e).forEach(t=>{ge(n,t,e[t])})}var _n=Object.defineProperty;function ge(n,e,t,i){_n(n,e,te(t&&ne(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},i))}function Ge(n){return{from:function(e){return n.prototype=Object.create(e.prototype),ge(n.prototype,"constructor",n),{extend:We.bind(null,n.prototype)}}}}var Is=Object.getOwnPropertyDescriptor;function Gi(n,e){let t=Is(n,e),i;return t||(i=it(n))&&Gi(i,e)}var ks=[].slice;function Bt(n,e,t){return ks.call(n,e,t)}function An(n,e){return e(n)}function Qe(n){if(!n)throw new Error("Assertion Failed")}function Mn(n){N.setImmediate?setImmediate(n):setTimeout(n,0)}function Dn(n,e){return n.reduce((t,i,s)=>{var r=e(i,s);return r&&(t[r[0]]=r[1]),t},{})}function $s(n,e,t){try{n.apply(null,t)}catch(i){e&&e(i)}}function me(n,e){if(ne(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],i=0,s=e.length;i<s;++i){var r=me(n,e[i]);t.push(r)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a===void 0?void 0:me(a,e.substr(o+1))}}function se(n,e,t){if(!(!n||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){Qe(typeof t!="string"&&"length"in t);for(var i=0,s=e.length;i<s;++i)se(n,e[i],t[i])}else{var r=e.indexOf(".");if(r!==-1){var o=e.substr(0,r),a=e.substr(r+1);if(a==="")t===void 0?Z(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var l=n[o];(!l||!ne(n,o))&&(l=n[o]={}),se(l,a,t)}}else t===void 0?Z(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function Vs(n,e){typeof e=="string"?se(n,e,void 0):"length"in e&&[].map.call(e,function(t){se(n,t,void 0)})}function Pn(n){var e={};for(var t in n)ne(n,t)&&(e[t]=n[t]);return e}var Rs=[].concat;function In(n){return Rs.apply([],n)}var kn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(In([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>N[n]),Ns=kn.map(n=>N[n]);Dn(kn,n=>[n,!0]);var Se=null;function ct(n){Se=typeof WeakMap!="undefined"&&new WeakMap;let e=gi(n);return Se=null,e}function gi(n){if(!n||typeof n!="object")return n;let e=Se&&Se.get(n);if(e)return e;if(Z(n)){e=[],Se&&Se.set(n,e);for(var t=0,i=n.length;t<i;++t)e.push(gi(n[t]))}else if(Ns.indexOf(n.constructor)>=0)e=n;else{let r=it(n);e=r===Object.prototype?{}:Object.create(r),Se&&Se.set(n,e);for(var s in n)ne(n,s)&&(e[s]=gi(n[s]))}return e}var{toString:Fs}={};function vi(n){return Fs.call(n).slice(8,-1)}var yi=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",Ls=typeof yi=="symbol"?function(n){var e;return n!=null&&(e=n[yi])&&e.apply(n)}:function(){return null},He={};function de(n){var e,t,i,s;if(arguments.length===1){if(Z(n))return n.slice();if(this===He&&typeof n=="string")return[n];if(s=Ls(n)){for(t=[];i=s.next(),!i.done;)t.push(i.value);return t}if(n==null)return[n];if(e=n.length,typeof e=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}var qi=typeof Symbol!="undefined"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1,le=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function $n(n,e){le=n,Vn=e}var Vn=()=>!0,Ks=!new Error("").stack;function Re(){if(Ks)try{throw Re.arguments,new Error}catch(n){return n}return new Error}function bi(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(Vn).map(i=>`
`+i).join("")):""}var Hs=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Rn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ji=Hs.concat(Rn),Bs={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function qe(n,e){this._e=Re(),this.name=n,this.message=e}Ge(qe).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+bi(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Nn(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,i,s)=>s.indexOf(t)===i).join(`
`)}function It(n,e,t,i){this._e=Re(),this.failures=e,this.failedKeys=i,this.successCount=t,this.message=Nn(n,e)}Ge(It).from(qe);function Ze(n,e){this._e=Re(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=Nn(n,e)}Ge(Ze).from(qe);var zi=ji.reduce((n,e)=>(n[e]=e+"Error",n),{}),Ws=qe,A=ji.reduce((n,e)=>{var t=e+"Error";function i(s,r){this._e=Re(),this.name=t,s?typeof s=="string"?(this.message=`${s}${r?`
 `+r:""}`,this.inner=r||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=Bs[e]||t,this.inner=null)}return Ge(i).from(Ws),n[e]=i,n},{});A.Syntax=SyntaxError;A.Type=TypeError;A.Range=RangeError;var mn=Rn.reduce((n,e)=>(n[e+"Error"]=A[e],n),{});function Gs(n,e){if(!n||n instanceof qe||n instanceof TypeError||n instanceof SyntaxError||!n.name||!mn[n.name])return n;var t=new mn[n.name](e||n.message,n);return"stack"in n&&ge(t,"stack",{get:function(){return this.inner.stack}}),t}var Wt=ji.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=A[e]),n),{});Wt.ModifyError=It;Wt.DexieError=qe;Wt.BulkError=Ze;function R(){}function ut(n){return n}function qs(n,e){return n==null||n===ut?e:function(t){return e(n(t))}}function $e(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function js(n,e){return n===R?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var r=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?$e(i,this.onsuccess):i),s&&(this.onerror=this.onerror?$e(s,this.onerror):s),r!==void 0?r:t}}function zs(n,e){return n===R?e:function(){n.apply(this,arguments);var t=this.onsuccess,i=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?$e(t,this.onsuccess):t),i&&(this.onerror=this.onerror?$e(i,this.onerror):i)}}function Us(n,e){return n===R?e:function(t){var i=n.apply(this,arguments);te(t,i);var s=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?$e(s,this.onsuccess):s),r&&(this.onerror=this.onerror?$e(r,this.onerror):r),i===void 0?o===void 0?void 0:o:te(i,o)}}function Ys(n,e){return n===R?e:function(){return e.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function Ui(n,e){return n===R?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var i=this,s=arguments.length,r=new Array(s);s--;)r[s]=arguments[s];return t.then(function(){return e.apply(i,r)})}return e.apply(this,arguments)}}var nt={},Xs=100,Qs=20,Fn=100,[wi,kt,xi]=typeof Promise=="undefined"?[]:(()=>{let n=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[n,it(n),n];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,it(e),n]})(),Ln=kt&&kt.then,Tt=wi&&wi.constructor,Yi=!!xi,Ci=!1,Js=xi?()=>{xi.then(xt)}:N.setImmediate?setImmediate.bind(null,xt):N.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{xt(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(xt,0)},st=function(n,e){Je.push([n,e]),$t&&(Js(),$t=!1)},Si=!0,$t=!0,Ie=[],_t=[],Ei=null,Oi=ut,Be={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:yn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{yn(n[0],n[1])}catch(e){}})}},_=Be,Je=[],ke=0,At=[];function E(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=R,this._lib=!1;var e=this._PSD=_;if(le&&(this._stackHolder=Re(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==nt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&_i(this,this._value);return}this._state=null,this._value=null,++e.ref,Hn(this,n)}var Ti={get:function(){var n=_,e=Vt;function t(i,s){var r=!n.global&&(n!==_||e!==Vt);let o=r&&!ve();var a=new E((l,c)=>{Xi(this,new Kn(Nt(i,n,r,o),Nt(s,n,r,o),l,c,n))});return le&&Gn(a,this),a}return t.prototype=nt,t},set:function(n){ge(this,"then",n&&n.prototype===nt?Ti:{get:function(){return n},set:Ti.set})}};We(E.prototype,{then:Ti,_then:function(n,e){Xi(this,new Kn(null,null,n,e,_))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,i=>i instanceof e?t(i):Mt(i)):this.then(null,i=>i&&i.name===e?t(i):Mt(i))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),Mt(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ci=!0;var n=Wn(this,[],Qs),e=n.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Ci=!1}}},timeout:function(n,e){return n<1/0?new E((t,i)=>{var s=setTimeout(()=>i(new A.Timeout(e)),n);this.then(t,i).finally(clearTimeout.bind(null,s))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&ge(E.prototype,Symbol.toStringTag,"Dexie.Promise");Be.env=qn();function Kn(n,e,t,i,s){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=i,this.psd=s}We(E,{all:function(){var n=de.apply(null,arguments).map(Rt);return new E(function(e,t){n.length===0&&e([]);var i=n.length;n.forEach((s,r)=>E.resolve(s).then(o=>{n[r]=o,--i||e(n)},t))})},resolve:n=>{if(n instanceof E)return n;if(n&&typeof n.then=="function")return new E((t,i)=>{n.then(t,i)});var e=new E(nt,!0,n);return Gn(e,Ei),e},reject:Mt,race:function(){var n=de.apply(null,arguments).map(Rt);return new E((e,t)=>{n.map(i=>E.resolve(i).then(e,t))})},PSD:{get:()=>_,set:n=>_=n},totalEchoes:{get:()=>Vt},newPSD:Oe,usePSD:ze,scheduler:{get:()=>st,set:n=>{st=n}},rejectionMapper:{get:()=>Oi,set:n=>{Oi=n}},follow:(n,e)=>new E((t,i)=>Oe((s,r)=>{var o=_;o.unhandleds=[],o.onunhandled=r,o.finalize=$e(function(){er(()=>{this.unhandleds.length===0?s():r(this.unhandleds[0])})},o.finalize),n()},e,t,i))});Tt&&(Tt.allSettled&&ge(E,"allSettled",function(){let n=de.apply(null,arguments).map(Rt);return new E(e=>{n.length===0&&e([]);let t=n.length,i=new Array(t);n.forEach((s,r)=>E.resolve(s).then(o=>i[r]={status:"fulfilled",value:o},o=>i[r]={status:"rejected",reason:o}).then(()=>--t||e(i)))})}),Tt.any&&typeof AggregateError!="undefined"&&ge(E,"any",function(){let n=de.apply(null,arguments).map(Rt);return new E((e,t)=>{n.length===0&&t(new AggregateError([]));let i=n.length,s=new Array(i);n.forEach((r,o)=>E.resolve(r).then(a=>e(a),a=>{s[o]=a,--i||t(new AggregateError(s))}))})}));function Hn(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var i=n._lib&&ht();t&&typeof t.then=="function"?Hn(n,(s,r)=>{t instanceof E?t._then(s,r):t.then(s,r)}):(n._state=!0,n._value=t,Bn(n)),i&&pt()}},_i.bind(null,n))}catch(t){_i(n,t)}}function _i(n,e){if(_t.push(e),n._state===null){var t=n._lib&&ht();e=Oi(e),n._state=!1,n._value=e,le&&e!==null&&typeof e=="object"&&!e._promise&&$s(()=>{var i=Gi(e,"stack");e._promise=n,ge(e,"stack",{get:()=>Ci?i&&(i.get?i.get.apply(e):i.value):n.stack})}),tr(n),Bn(n),t&&pt()}}function Bn(n){var e=n._listeners;n._listeners=[];for(var t=0,i=e.length;t<i;++t)Xi(n,e[t]);var s=n._PSD;--s.ref||s.finalize(),ke===0&&(++ke,st(()=>{--ke===0&&Qi()},[]))}function Xi(n,e){if(n._state===null){n._listeners.push(e);return}var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++ke,st(Zs,[t,n,e])}function Zs(n,e,t){try{Ei=e;var i,s=e._value;e._state?i=n(s):(_t.length&&(_t=[]),i=n(s),_t.indexOf(s)===-1&&ir(e)),t.resolve(i)}catch(r){t.reject(r)}finally{Ei=null,--ke===0&&Qi(),--t.psd.ref||t.psd.finalize()}}function Wn(n,e,t){if(e.length===t)return e;var i="";if(n._state===!1){var s=n._value,r,o;s!=null?(r=s.name||"Error",o=s.message||s,i=bi(s,0)):(r=s,o=""),e.push(r+(o?": "+o:"")+i)}return le&&(i=bi(n._stackHolder,2),i&&e.indexOf(i)===-1&&e.push(i),n._prev&&Wn(n._prev,e,t)),e}function Gn(n,e){var t=e?e._numPrev+1:0;t<Xs&&(n._prev=e,n._numPrev=t)}function xt(){ht()&&pt()}function ht(){var n=Si;return Si=!1,$t=!1,n}function pt(){var n,e,t;do for(;Je.length>0;)for(n=Je,Je=[],t=n.length,e=0;e<t;++e){var i=n[e];i[0].apply(null,i[1])}while(Je.length>0);Si=!0,$t=!0}function Qi(){var n=Ie;Ie=[],n.forEach(i=>{i._PSD.onunhandled.call(null,i._value,i)});for(var e=At.slice(0),t=e.length;t;)e[--t]()}function er(n){function e(){n(),At.splice(At.indexOf(e),1)}At.push(e),++ke,st(()=>{--ke===0&&Qi()},[])}function tr(n){Ie.some(e=>e._value===n._value)||Ie.push(n)}function ir(n){for(var e=Ie.length;e;)if(Ie[--e]._value===n._value){Ie.splice(e,1);return}}function Mt(n){return new E(nt,!1,n)}function F(n,e){var t=_;return function(){var i=ht(),s=_;try{return Te(t,!0),n.apply(this,arguments)}catch(r){e&&e(r)}finally{Te(s,!1),i&&pt()}}}var J={awaits:0,echoes:0,id:0},nr=0,Dt=[],ui=0,Vt=0,sr=0;function Oe(n,e,t,i){var s=_,r=Object.create(s);r.parent=s,r.ref=0,r.global=!1,r.id=++sr;var o=Be.env;r.env=Yi?{Promise:E,PromiseProp:{value:E,configurable:!0,writable:!0},all:E.all,race:E.race,allSettled:E.allSettled,any:E.any,resolve:E.resolve,reject:E.reject,nthen:gn(o.nthen,r),gthen:gn(o.gthen,r)}:{},e&&te(r,e),++s.ref,r.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=ze(r,n,t,i);return r.ref===0&&r.finalize(),a}function je(){return J.id||(J.id=++nr),++J.awaits,J.echoes+=Fn,J.id}function ve(){return J.awaits?(--J.awaits===0&&(J.id=0),J.echoes=J.awaits*Fn,!0):!1}(""+Ln).indexOf("[native code]")===-1&&(je=ve=R);function Rt(n){return J.echoes&&n&&n.constructor===Tt?(je(),n.then(e=>(ve(),e),e=>(ve(),q(e)))):n}function rr(n){++Vt,(!J.echoes||--J.echoes===0)&&(J.echoes=J.id=0),Dt.push(_),Te(n,!0)}function or(){var n=Dt[Dt.length-1];Dt.pop(),Te(n,!1)}function Te(n,e){var t=_;if((e?J.echoes&&(!ui++||n!==_):ui&&(!--ui||n!==_))&&jn(e?rr.bind(null,n):or),n!==_&&(_=n,t===Be&&(Be.env=qn()),Yi)){var i=Be.env.Promise,s=n.env;kt.then=s.nthen,i.prototype.then=s.gthen,(t.global||n.global)&&(Object.defineProperty(N,"Promise",s.PromiseProp),i.all=s.all,i.race=s.race,i.resolve=s.resolve,i.reject=s.reject,s.allSettled&&(i.allSettled=s.allSettled),s.any&&(i.any=s.any))}}function qn(){var n=N.Promise;return Yi?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(N,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:kt.then,gthen:n.prototype.then}:{}}function ze(n,e,t,i,s){var r=_;try{return Te(n,!0),e(t,i,s)}finally{Te(r,!1)}}function jn(n){Ln.call(wi,n)}function Nt(n,e,t,i){return typeof n!="function"?n:function(){var s=_;t&&je(),Te(e,!0);try{return n.apply(this,arguments)}finally{Te(s,!1),i&&jn(ve)}}}function gn(n,e){return function(t,i){return n.call(this,Nt(t,e),Nt(i,e))}}var vn="unhandledrejection";function yn(n,e){var t;try{t=e.onuncatched(n)}catch(r){}if(t!==!1)try{var i,s={promise:e,reason:n};if(N.document&&document.createEvent?(i=document.createEvent("Event"),i.initEvent(vn,!0,!0),te(i,s)):N.CustomEvent&&(i=new CustomEvent(vn,{detail:s}),te(i,s)),i&&N.dispatchEvent&&(dispatchEvent(i),!N.PromiseRejectionEvent&&N.onunhandledrejection))try{N.onunhandledrejection(i)}catch(r){}le&&i&&!i.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch(r){}}var q=E.reject;function Ai(n,e,t,i){if(!n.idbdb||!n._state.openComplete&&!_.letThrough&&!n._vip){if(n._state.openComplete)return q(new A.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return q(new A.DatabaseClosed);n.open().catch(R)}return n._state.dbReadyPromise.then(()=>Ai(n,e,t,i))}else{var s=n._createTransaction(e,t,n._dbSchema);try{s.create(),n._state.PR1398_maxLoop=3}catch(r){return r.name===zi.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Ai(n,e,t,i))):q(r)}return s._promise(e,(r,o)=>Oe(()=>(_.trans=s,i(r,o,s)))).then(r=>s._completion.then(()=>r))}}var bn="3.2.2",Pe=String.fromCharCode(65535),Mi=-1/0,he="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",zn="String expected.",et=[],Gt=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ar=Gt,lr=Gt,Un=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),qt="__dbnames",hi="readonly",pi="readwrite";function Ve(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}var Yn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ct(n){return typeof n=="string"&&!/\./.test(n)?e=>(e[n]===void 0&&n in e&&(e=ct(e),delete e[n]),e):e=>e}var Di=class{_trans(e,t,i){let s=this._tx||_.trans,r=this.name;function o(l,c,h){if(!h.schema[r])throw new A.NotFound("Table "+r+" not part of transaction");return t(h.idbtrans,h)}let a=ht();try{return s&&s.db===this.db?s===_.trans?s._promise(e,o,i):Oe(()=>s._promise(e,o,i),{trans:s,transless:_.transless||_}):Ai(this.db,e,[this.name],o)}finally{a&&pt()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",i=>this.core.get({trans:i,key:e}).then(s=>this.hook.reading.fire(s))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Z(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let t=G(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);let i=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&t.every(h=>c.keyPath.indexOf(h)>=0)&&c.keyPath.every(h=>t.indexOf(h)>=0))[0];if(i&&this.db._maxKey!==Pe)return this.where(i.name).equals(i.keyPath.map(c=>e[c]));!i&&le&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);let{idxByName:s}=this.schema,r=this.db._deps.indexedDB;function o(c,h){try{return r.cmp(c,h)===0}catch(p){return!1}}let[a,l]=t.reduce(([c,h],p)=>{let d=s[p],u=e[p];return[c||d,c||!d?Ve(h,d&&d.multi?v=>{let m=me(v,p);return Z(m)&&m.some(y=>o(u,y))}:v=>o(u,me(v,p))):h]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(l):i?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Z(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let t=i=>{if(!i)return i;let s=Object.create(e.prototype);for(var r in i)if(ne(i,r))try{s[r]=i[r]}catch(o){}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){function e(t){te(this,t)}return this.mapToClass(e)}add(e,t){let{auto:i,keyPath:s}=this.schema.primKey,r=e;return s&&i&&(r=Ct(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[r]})).then(o=>o.numFailures?E.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{se(e,s,o)}catch(a){}return o})}update(e,t){if(typeof e=="object"&&!Z(e)){let i=me(e,this.schema.primKey.keyPath);if(i===void 0)return q(new A.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?G(t).forEach(s=>{se(e,s,t[s])}):t(e,{value:e,primKey:i})}catch(s){}return this.where(":id").equals(i).modify(t)}else return this.where(":id").equals(e).modify(t)}put(e,t){let{auto:i,keyPath:s}=this.schema.primKey,r=e;return s&&i&&(r=Ct(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[r],keys:t!=null?[t]:null})).then(o=>o.numFailures?E.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{se(e,s,o)}catch(a){}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?E.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Yn})).then(e=>e.numFailures?E.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(i=>i.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,t,i){let s=Array.isArray(t)?t:void 0;i=i||(s?void 0:t);let r=i?i.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new A.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,h=l&&a?e.map(Ct(l)):e;return this.core.mutate({trans:o,type:"add",keys:s,values:h,wantResults:r}).then(({numFailures:p,results:d,lastResult:u,failures:v})=>{let m=r?d:u;if(p===0)return m;throw new Ze(`${this.name}.bulkAdd(): ${p} of ${c} operations failed`,v)})})}bulkPut(e,t,i){let s=Array.isArray(t)?t:void 0;i=i||(s?void 0:t);let r=i?i.allKeys:void 0;return this._trans("readwrite",o=>{let{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new A.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");let c=e.length,h=l&&a?e.map(Ct(l)):e;return this.core.mutate({trans:o,type:"put",keys:s,values:h,wantResults:r}).then(({numFailures:p,results:d,lastResult:u,failures:v})=>{let m=r?d:u;if(p===0)return m;throw new Ze(`${this.name}.bulkPut(): ${p} of ${c} operations failed`,v)})})}bulkDelete(e){let t=e.length;return this._trans("readwrite",i=>this.core.mutate({trans:i,type:"delete",keys:e})).then(({numFailures:i,lastResult:s,failures:r})=>{if(i===0)return s;throw new Ze(`${this.name}.bulkDelete(): ${i} of ${t} operations failed`,r)})}};function dt(n){var e={},t=function(a,l){if(l){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return e[a].subscribe.apply(null,h),n}else if(typeof a=="string")return e[a]};t.addEventType=r;for(var i=1,s=arguments.length;i<s;++i)r(arguments[i]);return t;function r(a,l,c){if(typeof a=="object")return o(a);l||(l=Ys),c||(c=R);var h={subscribers:[],fire:c,subscribe:function(p){h.subscribers.indexOf(p)===-1&&(h.subscribers.push(p),h.fire=l(h.fire,p))},unsubscribe:function(p){h.subscribers=h.subscribers.filter(function(d){return d!==p}),h.fire=h.subscribers.reduce(l,c)}};return e[a]=t[a]=h,h}function o(a){G(a).forEach(function(l){var c=a[l];if(Z(c))r(l,a[l][0],a[l][1]);else if(c==="asap")var h=r(l,ut,function(){for(var d=arguments.length,u=new Array(d);d--;)u[d]=arguments[d];h.subscribers.forEach(function(v){Mn(function(){v.apply(null,u)})})});else throw new A.InvalidArgument("Invalid event config")})}}function ft(n,e){return Ge(e).from({prototype:n}),e}function cr(n){return ft(Di.prototype,function(t,i,s){this.db=n,this._tx=s,this.name=t,this.schema=i,this.hook=n._allTables[t]?n._allTables[t].hook:dt(null,{creating:[js,R],reading:[qs,ut],updating:[Us,R],deleting:[zs,R]})})}function Le(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function di(n,e){n.filter=Ve(n.filter,e)}function fi(n,e,t){var i=n.replayFilter;n.replayFilter=i?()=>Ve(i(),e()):e,n.justLimit=t&&!i}function ur(n,e){n.isMatch=Ve(n.isMatch,e)}function Pt(n,e){if(n.isPrimKey)return e.primaryKey;let t=e.getIndexByKeyPath(n.index);if(!t)throw new A.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function wn(n,e,t){let i=Pt(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:i,range:n.range}})}function St(n,e,t,i){let s=n.replayFilter?Ve(n.filter,n.replayFilter()):n.filter;if(n.or){let r={},o=(a,l,c)=>{if(!s||s(l,c,d=>l.stop(d),d=>l.fail(d))){var h=l.primaryKey,p=""+h;p==="[object ArrayBuffer]"&&(p=""+new Uint8Array(h)),ne(r,p)||(r[p]=!0,e(a,l,c))}};return Promise.all([n.or._iterate(o,t),xn(wn(n,i,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}else return xn(wn(n,i,t),Ve(n.algorithm,s),e,!n.keysOnly&&n.valueMapper)}function xn(n,e,t,i){var s=i?(o,a,l)=>t(i(o),a,l):t,r=F(s);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!e||e(o,l=>a=l,l=>{o.stop(l),a=R},l=>{o.fail(l),a=R}))&&r(o.value,o,l=>a=l),a()})})}function ee(n,e){try{let t=Cn(n),i=Cn(e);if(t!==i)return t==="Array"?1:i==="Array"?-1:t==="binary"?1:i==="binary"?-1:t==="string"?1:i==="string"?-1:t==="Date"?1:i!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return pr(Sn(n),Sn(e));case"Array":return hr(n,e)}}catch(t){}return NaN}function hr(n,e){let t=n.length,i=e.length,s=t<i?t:i;for(let r=0;r<s;++r){let o=ee(n[r],e[r]);if(o!==0)return o}return t===i?0:t<i?-1:1}function pr(n,e){let t=n.length,i=e.length,s=t<i?t:i;for(let r=0;r<s;++r)if(n[r]!==e[r])return n[r]<e[r]?-1:1;return t===i?0:t<i?-1:1}function Cn(n){let e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";let t=vi(n);return t==="ArrayBuffer"?"binary":t}function Sn(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}var Pi=class{_read(e,t){var i=this._ctx;return i.error?i.table._trans(null,q.bind(null,i.error)):i.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,q.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Ve(t.algorithm,e)}_iterate(e,t){return St(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return e&&te(i,e),t._ctx=i,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(i=>St(t,e,i,t.table.core))}count(e){return this._read(t=>{let i=this._ctx,s=i.table.core;if(Le(i,!0))return s.count({trans:t,query:{index:Pt(i,s.schema),range:i.range}}).then(o=>Math.min(o,i.limit));var r=0;return St(i,()=>(++r,!1),t,s).then(()=>r)}).then(e)}sortBy(e,t){let i=e.split(".").reverse(),s=i[0],r=i.length-1;function o(c,h){return h?o(c[i[h]],h-1):c[s]}var a=this._ctx.dir==="next"?1:-1;function l(c,h){var p=o(c,r),d=o(h,r);return p<d?-a:p>d?a:0}return this.toArray(function(c){return c.sort(l)}).then(t)}toArray(e){return this._read(t=>{var i=this._ctx;if(i.dir==="next"&&Le(i,!0)&&i.limit>0){let{valueMapper:s}=i,r=Pt(i,i.table.core.schema);return i.table.core.query({trans:t,limit:i.limit,values:!0,query:{index:r,range:i.range}}).then(({result:o})=>s?o.map(s):o)}else{let s=[];return St(i,r=>s.push(r),t,i.table.core).then(()=>s)}},e)}offset(e){var t=this._ctx;return e<=0?this:(t.offset+=e,Le(t)?fi(t,()=>{var i=e;return(s,r)=>i===0?!0:i===1?(--i,!1):(r(()=>{s.advance(i),i=0}),!1)}):fi(t,()=>{var i=e;return()=>--i<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),fi(this._ctx,()=>{var t=e;return function(i,s,r){return--t<=0&&s(r),t>=0}},!0),this}until(e,t){return di(this._ctx,function(i,s,r){return e(i.value)?(s(r),t):!0}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return di(this._ctx,function(t){return e(t.value)}),ur(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(i,s){e(s.primaryKey,s)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var i=[];return this.each(function(s,r){i.push(r.key)}).then(function(){return i}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&Le(t,!0)&&t.limit>0)return this._read(s=>{var r=Pt(t,t.table.core.schema);return t.table.core.query({trans:s,values:!1,limit:t.limit,query:{index:r,range:t.range}})}).then(({result:s})=>s).then(e);t.keysOnly=!t.isMatch;var i=[];return this.each(function(s,r){i.push(r.primaryKey)}).then(function(){return i}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var i={};return di(this._ctx,function(s){var r=s.primaryKey.toString(),o=ne(i,r);return i[r]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(i=>{var s;if(typeof e=="function")s=e;else{var r=G(e),o=r.length;s=function(m){for(var y=!1,g=0;g<o;++g){var C=r[g],b=e[C];me(m,C)!==b&&(se(m,C,b),y=!0)}return y}}let a=t.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,p=[],d=0,u=[],v=(m,y)=>{let{failures:g,numFailures:C}=y;d+=m-C;for(let b of G(g))p.push(g[b])};return this.clone().primaryKeys().then(m=>{let y=g=>{let C=Math.min(h,m.length-g);return a.getMany({trans:i,keys:m.slice(g,g+C),cache:"immutable"}).then(b=>{let f=[],w=[],S=l?[]:null,O=[];for(let P=0;P<C;++P){let $=b[P],I={value:ct($),primKey:m[g+P]};s.call(I,I.value,I)!==!1&&(I.value==null?O.push(m[g+P]):!l&&ee(c($),c(I.value))!==0?(O.push(m[g+P]),f.push(I.value)):(w.push(I.value),l&&S.push(m[g+P])))}let T=Le(t)&&t.limit===1/0&&(typeof e!="function"||e===mi)&&{index:t.index,range:t.range};return Promise.resolve(f.length>0&&a.mutate({trans:i,type:"add",values:f}).then(P=>{for(let $ in P.failures)O.splice(parseInt($),1);v(f.length,P)})).then(()=>(w.length>0||T&&typeof e=="object")&&a.mutate({trans:i,type:"put",keys:S,values:w,criteria:T,changeSpec:typeof e!="function"&&e}).then(P=>v(w.length,P))).then(()=>(O.length>0||T&&e===mi)&&a.mutate({trans:i,type:"delete",keys:O,criteria:T}).then(P=>v(O.length,P))).then(()=>m.length>g+C&&y(g+h))})};return y(0).then(()=>{if(p.length>0)throw new It("Error modifying one or more objects",p,d,u);return m.length})})})}delete(){var e=this._ctx,t=e.range;return Le(e)&&(e.isPrimKey&&!lr||t.type===3)?this._write(i=>{let{primaryKey:s}=e.table.core.schema,r=t;return e.table.core.count({trans:i,query:{index:s,range:r}}).then(o=>e.table.core.mutate({trans:i,type:"deleteRange",range:r}).then(({failures:a,lastResult:l,results:c,numFailures:h})=>{if(h)throw new It("Could not delete some values",Object.keys(a).map(p=>a[p]),o-h);return o-h}))}):this.modify(mi)}},mi=(n,e)=>e.value=null;function dr(n){return ft(Pi.prototype,function(t,i){this.db=n;let s=Yn,r=null;if(i)try{s=i()}catch(c){r=c}let o=t._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:s,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:l!==ut?l:null}})}function fr(n,e){return n<e?-1:n===e?0:1}function mr(n,e){return n>e?-1:n===e?0:1}function ie(n,e,t){var i=n instanceof Ft?new n.Collection(n):n;return i._ctx.error=t?new t(e):new TypeError(e),i}function Ke(n){return new n.Collection(n,()=>Xn("")).limit(0)}function gr(n){return n==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function vr(n){return n==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function yr(n,e,t,i,s,r){for(var o=Math.min(n.length,i.length),a=-1,l=0;l<o;++l){var c=e[l];if(c!==i[l])return s(n[l],t[l])<0?n.substr(0,l)+t[l]+t.substr(l+1):s(n[l],i[l])<0?n.substr(0,l)+i[l]+t.substr(l+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;s(n[l],c)<0&&(a=l)}return o<i.length&&r==="next"?n+t.substr(n.length):o<n.length&&r==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+i[a]+t.substr(a+1)}function Et(n,e,t,i){var s,r,o,a,l,c,h,p=t.length;if(!t.every(m=>typeof m=="string"))return ie(n,zn);function d(m){s=gr(m),r=vr(m),o=m==="next"?fr:mr;var y=t.map(function(g){return{lower:r(g),upper:s(g)}}).sort(function(g,C){return o(g.lower,C.lower)});a=y.map(function(g){return g.upper}),l=y.map(function(g){return g.lower}),c=m,h=m==="next"?"":i}d("next");var u=new n.Collection(n,()=>Ce(a[0],l[p-1]+i));u._ondirectionchange=function(m){d(m)};var v=0;return u._addAlgorithm(function(m,y,g){var C=m.key;if(typeof C!="string")return!1;var b=r(C);if(e(b,l,v))return!0;for(var f=null,w=v;w<p;++w){var S=yr(C,b,a[w],l[w],o,c);S===null&&f===null?v=w+1:(f===null||o(f,S)>0)&&(f=S)}return y(f!==null?function(){m.continue(f+h)}:g),!1}),u}function Ce(n,e,t,i){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:i}}function Xn(n){return{type:1,lower:n,upper:n}}var Ft=class{get Collection(){return this._ctx.table.db.Collection}between(e,t,i,s){i=i!==!1,s=s===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(i||s)&&!(i&&s)?Ke(this):new this.Collection(this,()=>Ce(e,t,!i,!s))}catch(r){return ie(this,he)}}equals(e){return e==null?ie(this,he):new this.Collection(this,()=>Xn(e))}above(e){return e==null?ie(this,he):new this.Collection(this,()=>Ce(e,void 0,!0))}aboveOrEqual(e){return e==null?ie(this,he):new this.Collection(this,()=>Ce(e,void 0,!1))}below(e){return e==null?ie(this,he):new this.Collection(this,()=>Ce(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ie(this,he):new this.Collection(this,()=>Ce(void 0,e))}startsWith(e){return typeof e!="string"?ie(this,zn):this.between(e,e+Pe,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Et(this,(t,i)=>t.indexOf(i[0])===0,[e],Pe)}equalsIgnoreCase(e){return Et(this,(t,i)=>t===i[0],[e],"")}anyOfIgnoreCase(){var e=de.apply(He,arguments);return e.length===0?Ke(this):Et(this,(t,i)=>i.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=de.apply(He,arguments);return e.length===0?Ke(this):Et(this,(t,i)=>i.some(s=>t.indexOf(s)===0),e,Pe)}anyOf(){let e=de.apply(He,arguments),t=this._cmp;try{e.sort(t)}catch(r){return ie(this,he)}if(e.length===0)return Ke(this);let i=new this.Collection(this,()=>Ce(e[0],e[e.length-1]));i._ondirectionchange=r=>{t=r==="next"?this._ascending:this._descending,e.sort(t)};let s=0;return i._addAlgorithm((r,o,a)=>{let l=r.key;for(;t(l,e[s])>0;)if(++s,s===e.length)return o(a),!1;return t(l,e[s])===0?!0:(o(()=>{r.continue(e[s])}),!1)}),i}notEqual(e){return this.inAnyRange([[Mi,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=de.apply(He,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(i){return ie(this,he)}let t=e.reduce((i,s)=>i?i.concat([[i[i.length-1][1],s]]):[[Mi,s]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){let i=this._cmp,s=this._ascending,r=this._descending,o=this._min,a=this._max;if(e.length===0)return Ke(this);if(!e.every(f=>f[0]!==void 0&&f[1]!==void 0&&s(f[0],f[1])<=0))return ie(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",A.InvalidArgument);let l=!t||t.includeLowers!==!1,c=t&&t.includeUppers===!0;function h(f,w){let S=0,O=f.length;for(;S<O;++S){let T=f[S];if(i(w[0],T[1])<0&&i(w[1],T[0])>0){T[0]=o(T[0],w[0]),T[1]=a(T[1],w[1]);break}}return S===O&&f.push(w),f}let p=s;function d(f,w){return p(f[0],w[0])}let u;try{u=e.reduce(h,[]),u.sort(d)}catch(f){return ie(this,he)}let v=0,m=c?f=>s(f,u[v][1])>0:f=>s(f,u[v][1])>=0,y=l?f=>r(f,u[v][0])>0:f=>r(f,u[v][0])>=0;function g(f){return!m(f)&&!y(f)}let C=m,b=new this.Collection(this,()=>Ce(u[0][0],u[u.length-1][1],!l,!c));return b._ondirectionchange=f=>{f==="next"?(C=m,p=s):(C=y,p=r),u.sort(d)},b._addAlgorithm((f,w,S)=>{for(var O=f.key;C(O);)if(++v,v===u.length)return w(S),!1;return g(O)?!0:(this._cmp(O,u[v][1])===0||this._cmp(O,u[v][0])===0||w(()=>{p===s?f.continue(u[v][0]):f.continue(u[v][1])}),!1)}),b}startsWithAnyOf(){let e=de.apply(He,arguments);return e.every(t=>typeof t=="string")?e.length===0?Ke(this):this.inAnyRange(e.map(t=>[t,t+Pe])):ie(this,"startsWithAnyOf() only works with strings")}};function br(n){return ft(Ft.prototype,function(t,i,s){this.db=n,this._ctx={table:t,index:i===":id"?null:i,or:s};let r=n._deps.indexedDB;if(!r)throw new A.MissingAPI;this._cmp=this._ascending=r.cmp.bind(r),this._descending=(o,a)=>r.cmp(a,o),this._max=(o,a)=>r.cmp(o,a)>0?o:a,this._min=(o,a)=>r.cmp(o,a)<0?o:a,this._IDBKeyRange=n._deps.IDBKeyRange})}function oe(n){return F(function(e){return rt(e),n(e.target.error),!1})}function rt(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var ot="storagemutated",Ee="x-storagemutated-1",_e=dt(null,ot),Ii=class{_lock(){return Qe(!_.global),++this._reculock,this._reculock===1&&!_.global&&(_.lockOwnerFor=this),this}_unlock(){if(Qe(!_.global),--this._reculock===0)for(_.global||(_.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ze(e[1],e[0])}catch(t){}}return this}_locked(){return this._reculock&&_.lockOwnerFor!==this}create(e){if(!this.mode)return this;let t=this.db.idbdb,i=this.db._state.dbOpenError;if(Qe(!this.idbtrans),!e&&!t)switch(i&&i.name){case"DatabaseClosedError":throw new A.DatabaseClosed(i);case"MissingAPIError":throw new A.MissingAPI(i.message,i);default:throw new A.OpenFailed(i)}if(!this.active)throw new A.TransactionInactive;return Qe(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=F(s=>{rt(s),this._reject(e.error)}),e.onabort=F(s=>{rt(s),this.active&&this._reject(new A.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=F(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&_e.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,i){if(e==="readwrite"&&this.mode!=="readwrite")return q(new A.ReadOnly("Transaction is readonly"));if(!this.active)return q(new A.TransactionInactive);if(this._locked())return new E((r,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,i).then(r,o)},_])});if(i)return Oe(()=>{var r=new E((o,a)=>{this._lock();let l=t(o,a,this);l&&l.then&&l.then(o,a)});return r.finally(()=>this._unlock()),r._lib=!0,r});var s=new E((r,o)=>{var a=t(r,o,this);a&&a.then&&a.then(r,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();let i=E.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>i);else{t._waitingFor=i,t._waitingQueue=[];var s=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(s.get(-1/0).onsuccess=o)})()}var r=t._waitingFor;return new E((o,a)=>{i.then(l=>t._waitingQueue.push(F(o.bind(null,l))),l=>t._waitingQueue.push(F(a.bind(null,l)))).finally(()=>{t._waitingFor===r&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new A.Abort))}table(e){let t=this._memoizedTables||(this._memoizedTables={});if(ne(t,e))return t[e];let i=this.schema[e];if(!i)throw new A.NotFound("Table "+e+" not part of transaction");let s=new this.db.Table(e,i,this);return s.core=this.db.core.table(e),t[e]=s,s}};function wr(n){return ft(Ii.prototype,function(t,i,s,r,o){this.db=n,this.mode=t,this.storeNames=i,this.schema=s,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=dt(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new E((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),q(a)})})}function ki(n,e,t,i,s,r,o){return{name:n,keyPath:e,unique:t,multi:i,auto:s,compound:r,src:(t&&!o?"&":"")+(i?"*":"")+(s?"++":"")+Qn(e)}}function Qn(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Jn(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:Dn(t,i=>[i.name,i])}}function xr(n){return n.length===1?n[0]:n}var at=n=>{try{return n.only([[]]),at=()=>[[]],[[]]}catch(e){return at=()=>Pe,Pe}};function $i(n){return n==null?()=>{}:typeof n=="string"?Cr(n):e=>me(e,n)}function Cr(n){return n.split(".").length===1?t=>t[n]:t=>me(t,n)}function En(n){return[].slice.call(n)}var Sr=0;function tt(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function Er(n,e,t){function i(h,p){let d=En(h.objectStoreNames);return{schema:{name:h.name,tables:d.map(u=>p.objectStore(u)).map(u=>{let{keyPath:v,autoIncrement:m}=u,y=Z(v),g=v==null,C={},b={name:u.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:y,keyPath:v,autoIncrement:m,unique:!0,extractKey:$i(v)},indexes:En(u.indexNames).map(f=>u.index(f)).map(f=>{let{name:w,unique:S,multiEntry:O,keyPath:T}=f,P=Z(T),$={name:w,compound:P,keyPath:T,unique:S,multiEntry:O,extractKey:$i(T)};return C[tt(T)]=$,$}),getIndexByKeyPath:f=>C[tt(f)]};return C[":id"]=b.primaryKey,v!=null&&(C[tt(v)]=b.primaryKey),b})},hasGetAll:d.length>0&&"getAll"in p.objectStore(d[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function s(h){if(h.type===3)return null;if(h.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:p,upper:d,lowerOpen:u,upperOpen:v}=h;return p===void 0?d===void 0?null:e.upperBound(d,!!v):d===void 0?e.lowerBound(p,!!u):e.bound(p,d,!!u,!!v)}function r(h){let p=h.name;function d({trans:m,type:y,keys:g,values:C,range:b}){return new Promise((f,w)=>{f=F(f);let S=m.objectStore(p),O=S.keyPath==null,T=y==="put"||y==="add";if(!T&&y!=="delete"&&y!=="deleteRange")throw new Error("Invalid operation type: "+y);let{length:P}=g||C||{length:1};if(g&&C&&g.length!==C.length)throw new Error("Given keys array must have same length as given values array.");if(P===0)return f({numFailures:0,failures:{},results:[],lastResult:void 0});let $,I=[],B=[],M=0,Q=j=>{++M,rt(j)};if(y==="deleteRange"){if(b.type===4)return f({numFailures:M,failures:B,results:[],lastResult:void 0});b.type===3?I.push($=S.clear()):I.push($=S.delete(s(b)))}else{let[j,W]=T?O?[C,g]:[C,null]:[g,null];if(T)for(let L=0;L<P;++L)I.push($=W&&W[L]!==void 0?S[y](j[L],W[L]):S[y](j[L])),$.onerror=Q;else for(let L=0;L<P;++L)I.push($=S[y](j[L])),$.onerror=Q}let z=j=>{let W=j.target.result;I.forEach((L,we)=>L.error!=null&&(B[we]=L.error)),f({numFailures:M,failures:B,results:y==="delete"?g:I.map(L=>L.result),lastResult:W})};$.onerror=j=>{Q(j),z(j)},$.onsuccess=z})}function u({trans:m,values:y,query:g,reverse:C,unique:b}){return new Promise((f,w)=>{f=F(f);let{index:S,range:O}=g,T=m.objectStore(p),P=S.isPrimaryKey?T:T.index(S.name),$=C?b?"prevunique":"prev":b?"nextunique":"next",I=y||!("openKeyCursor"in P)?P.openCursor(s(O),$):P.openKeyCursor(s(O),$);I.onerror=oe(w),I.onsuccess=F(B=>{let M=I.result;if(!M){f(null);return}M.___id=++Sr,M.done=!1;let Q=M.continue.bind(M),z=M.continuePrimaryKey;z&&(z=z.bind(M));let j=M.advance.bind(M),W=()=>{throw new Error("Cursor not started")},L=()=>{throw new Error("Cursor not stopped")};M.trans=m,M.stop=M.continue=M.continuePrimaryKey=M.advance=W,M.fail=F(w),M.next=function(){let we=1;return this.start(()=>we--?this.continue():this.stop()).then(()=>this)},M.start=we=>{let yt=new Promise((U,ue)=>{U=F(U),I.onerror=oe(ue),M.fail=ue,M.stop=oi=>{M.stop=M.continue=M.continuePrimaryKey=M.advance=L,U(oi)}}),Xe=()=>{if(I.result)try{we()}catch(U){M.fail(U)}else M.done=!0,M.start=()=>{throw new Error("Cursor behind last entry")},M.stop()};return I.onsuccess=F(U=>{I.onsuccess=Xe,Xe()}),M.continue=Q,M.continuePrimaryKey=z,M.advance=j,Xe(),yt},f(M)},w)})}function v(m){return y=>new Promise((g,C)=>{g=F(g);let{trans:b,values:f,limit:w,query:S}=y,O=w===1/0?void 0:w,{index:T,range:P}=S,$=b.objectStore(p),I=T.isPrimaryKey?$:$.index(T.name),B=s(P);if(w===0)return g({result:[]});if(m){let M=f?I.getAll(B,O):I.getAllKeys(B,O);M.onsuccess=Q=>g({result:Q.target.result}),M.onerror=oe(C)}else{let M=0,Q=f||!("openKeyCursor"in I)?I.openCursor(B):I.openKeyCursor(B),z=[];Q.onsuccess=j=>{let W=Q.result;if(!W)return g({result:z});if(z.push(f?W.value:W.primaryKey),++M===w)return g({result:z});W.continue()},Q.onerror=oe(C)}})}return{name:p,schema:h,mutate:d,getMany({trans:m,keys:y}){return new Promise((g,C)=>{g=F(g);let b=m.objectStore(p),f=y.length,w=new Array(f),S=0,O=0,T,P=I=>{let B=I.target;(w[B._pos]=B.result)!=null,++O===S&&g(w)},$=oe(C);for(let I=0;I<f;++I)y[I]!=null&&(T=b.get(y[I]),T._pos=I,T.onsuccess=P,T.onerror=$,++S);S===0&&g(w)})},get({trans:m,key:y}){return new Promise((g,C)=>{g=F(g);let f=m.objectStore(p).get(y);f.onsuccess=w=>g(w.target.result),f.onerror=oe(C)})},query:v(a),openCursor:u,count({query:m,trans:y}){let{index:g,range:C}=m;return new Promise((b,f)=>{let w=y.objectStore(p),S=g.isPrimaryKey?w:w.index(g.name),O=s(C),T=O?S.count(O):S.count();T.onsuccess=F(P=>b(P.target.result)),T.onerror=oe(f)})}}}let{schema:o,hasGetAll:a}=i(n,t),l=o.tables.map(h=>r(h)),c={};return l.forEach(h=>c[h.name]=h),{stack:"dbcore",transaction:n.transaction.bind(n),table(h){if(!c[h])throw new Error(`Table '${h}' not found`);return c[h]},MIN_KEY:-1/0,MAX_KEY:at(e),schema:o}}function Or(n,e){return e.reduce((t,{create:i})=>K(K({},t),i(t)),n)}function Tr(n,e,{IDBKeyRange:t,indexedDB:i},s){return{dbcore:Or(Er(e,t,s),n.dbcore)}}function Ji({_novip:n},e){let t=e.db,i=Tr(n._middlewares,t,n._deps,e);n.core=i.dbcore,n.tables.forEach(s=>{let r=s.name;n.core.schema.tables.some(o=>o.name===r)&&(s.core=n.core.table(r),n[r]instanceof n.Table&&(n[r].core=s.core))})}function Lt({_novip:n},e,t,i){t.forEach(s=>{let r=i[s];e.forEach(o=>{let a=Gi(o,s);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?ge(o,s,{get(){return this.table(s)},set(l){_n(this,s,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new n.Table(s,r))})})}function Vi({_novip:n},e){e.forEach(t=>{for(let i in t)t[i]instanceof n.Table&&delete t[i]})}function _r(n,e){return n._cfg.version-e._cfg.version}function Ar(n,e,t,i){let s=n._dbSchema,r=n._createTransaction("readwrite",n._storeNames,s);r.create(t),r._completion.catch(i);let o=r._reject.bind(r),a=_.transless||_;Oe(()=>{_.trans=r,_.transless=a,e===0?(G(s).forEach(l=>{Zi(t,l,s[l].primKey,s[l].indexes)}),Ji(n,t),E.follow(()=>n.on.populate.fire(r)).catch(o)):Mr(n,e,r,t).catch(o)})}function Mr({_novip:n},e,t,i){let s=[],r=n._versions,o=n._dbSchema=en(n,n.idbdb,i),a=!1;r.filter(h=>h._cfg.version>=e).forEach(h=>{s.push(()=>{let p=o,d=h._cfg.dbschema;Ni(n,p,i),Ni(n,d,i),o=n._dbSchema=d;let u=Zn(p,d);u.add.forEach(m=>{Zi(i,m[0],m[1].primKey,m[1].indexes)}),u.change.forEach(m=>{if(m.recreate)throw new A.Upgrade("Not yet support for changing primary key");{let y=i.objectStore(m.name);m.add.forEach(g=>Ri(y,g)),m.change.forEach(g=>{y.deleteIndex(g.name),Ri(y,g)}),m.del.forEach(g=>y.deleteIndex(g))}});let v=h._cfg.contentUpgrade;if(v&&h._cfg.version>e){Ji(n,i),t._memoizedTables={},a=!0;let m=Pn(d);u.del.forEach(b=>{m[b]=p[b]}),Vi(n,[n.Transaction.prototype]),Lt(n,[n.Transaction.prototype],G(m),m),t.schema=m;let y=qi(v);y&&je();let g,C=E.follow(()=>{if(g=v(t),g&&y){var b=ve.bind(null,null);g.then(b,b)}});return g&&typeof g.then=="function"?E.resolve(g):C.then(()=>g)}}),s.push(p=>{if(!a||!ar){let d=h._cfg.dbschema;Pr(d,p)}Vi(n,[n.Transaction.prototype]),Lt(n,[n.Transaction.prototype],n._storeNames,n._dbSchema),t.schema=n._dbSchema})});function c(){return s.length?E.resolve(s.shift()(t.idbtrans)).then(c):E.resolve()}return c().then(()=>{Dr(o,i)})}function Zn(n,e){let t={del:[],add:[],change:[]},i;for(i in n)e[i]||t.del.push(i);for(i in e){let s=n[i],r=e[i];if(!s)t.add.push([i,r]);else{let o={name:i,def:r,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(r.primKey.keyPath||"")||s.primKey.auto!==r.primKey.auto&&!Gt)o.recreate=!0,t.change.push(o);else{let a=s.idxByName,l=r.idxByName,c;for(c in a)l[c]||o.del.push(c);for(c in l){let h=a[c],p=l[c];h?h.src!==p.src&&o.change.push(p):o.add.push(p)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}}return t}function Zi(n,e,t,i){let s=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return i.forEach(r=>Ri(s,r)),s}function Dr(n,e){G(n).forEach(t=>{e.db.objectStoreNames.contains(t)||Zi(e,t,n[t].primKey,n[t].indexes)})}function Pr(n,e){[].slice.call(e.db.objectStoreNames).forEach(t=>n[t]==null&&e.db.deleteObjectStore(t))}function Ri(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function en(n,e,t){let i={};return Bt(e.objectStoreNames,0).forEach(r=>{let o=t.objectStore(r),a=o.keyPath,l=ki(Qn(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),c=[];for(let p=0;p<o.indexNames.length;++p){let d=o.index(o.indexNames[p]);a=d.keyPath;var h=ki(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);c.push(h)}i[r]=Jn(r,l,c)}),i}function Ir({_novip:n},e,t){n.verno=e.version/10;let i=n._dbSchema=en(n,e,t);n._storeNames=Bt(e.objectStoreNames,0),Lt(n,[n._allTables],G(i),i)}function kr(n,e){let t=en(n,n.idbdb,e),i=Zn(t,n._dbSchema);return!(i.add.length||i.change.some(s=>s.add.length||s.change.length))}function Ni({_novip:n},e,t){let i=t.db.objectStoreNames;for(let s=0;s<i.length;++s){let r=i[s],o=t.objectStore(r);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){let l=o.indexNames[a],c=o.index(l).keyPath,h=typeof c=="string"?c:"["+Bt(c).join("+")+"]";if(e[r]){let p=e[r].idxByName[h];p&&(p.name=l,delete e[r].idxByName[h],e[r].idxByName[l]=p)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&N.WorkerGlobalScope&&N instanceof N.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function $r(n){return n.split(",").map((e,t)=>{e=e.trim();let i=e.replace(/([&*]|\+\+)/g,""),s=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;return ki(i,s||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Z(s),t===0)})}var Fi=class{_parseStoresSpec(e,t){G(e).forEach(i=>{if(e[i]!==null){var s=$r(e[i]),r=s.shift();if(r.multi)throw new A.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new A.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new A.Schema("Index must have a name and cannot be an empty string")}),t[i]=Jn(i,r,s)}})}stores(e){let t=this.db;this._cfg.storesSource=this._cfg.storesSource?te(this._cfg.storesSource,e):e;let i=t._versions,s={},r={};return i.forEach(o=>{te(s,o._cfg.storesSource),r=o._cfg.dbschema={},o._parseStoresSpec(s,r)}),t._dbSchema=r,Vi(t,[t._allTables,t,t.Transaction.prototype]),Lt(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],G(r),r),t._storeNames=G(r),this}upgrade(e){return this._cfg.contentUpgrade=Ui(this._cfg.contentUpgrade||R,e),this}};function Vr(n){return ft(Fi.prototype,function(t){this.db=n,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function tn(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new ae(qt,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function nn(n){return n&&typeof n.databases=="function"}function Rr({indexedDB:n,IDBKeyRange:e}){return nn(n)?Promise.resolve(n.databases()).then(t=>t.map(i=>i.name).filter(i=>i!==qt)):tn(n,e).toCollection().primaryKeys()}function Nr({indexedDB:n,IDBKeyRange:e},t){!nn(n)&&t!==qt&&tn(n,e).put({name:t}).catch(R)}function Fr({indexedDB:n,IDBKeyRange:e},t){!nn(n)&&t!==qt&&tn(n,e).delete(t).catch(R)}function Li(n){return Oe(function(){return _.letThrough=!0,n()})}function Lr(){var n=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!n||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(t){var i=function(){return indexedDB.databases().finally(t)};e=setInterval(i,100),i()}).finally(function(){return clearInterval(e)})}function Kr(n){let e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?q(e.dbOpenError):n);le&&(e.openCanceller._stackHolder=Re()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let i=e.openCanceller;function s(){if(e.openCanceller!==i)throw new A.DatabaseClosed("db.open() was cancelled")}let r=e.dbReadyResolve,o=null,a=!1;return E.race([i,(typeof navigator=="undefined"?E.resolve():Lr()).then(()=>new E((l,c)=>{if(s(),!t)throw new A.MissingAPI;let h=n.name,p=e.autoSchema?t.open(h):t.open(h,Math.round(n.verno*10));if(!p)throw new A.MissingAPI;p.onerror=oe(c),p.onblocked=F(n._fireOnBlocked),p.onupgradeneeded=F(d=>{if(o=p.transaction,e.autoSchema&&!n._options.allowEmptyDB){p.onerror=rt,o.abort(),p.result.close();let v=t.deleteDatabase(h);v.onsuccess=v.onerror=F(()=>{c(new A.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=oe(c);var u=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=u<1,n._novip.idbdb=p.result,Ar(n,u/10,o,c)}},c),p.onsuccess=F(()=>{o=null;let d=n._novip.idbdb=p.result,u=Bt(d.objectStoreNames);if(u.length>0)try{let v=d.transaction(xr(u),"readonly");e.autoSchema?Ir(n,d,v):(Ni(n,n._dbSchema,v),kr(n,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ji(n,v)}catch(v){}et.push(n),d.onversionchange=F(v=>{e.vcFired=!0,n.on("versionchange").fire(v)}),d.onclose=F(v=>{n.on("close").fire(v)}),a&&Nr(n._deps,h),l()},c)}))]).then(()=>(s(),e.onReadyBeingFired=[],E.resolve(Li(()=>n.on.ready.fire(n.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(Ui,R);return e.onReadyBeingFired=[],E.resolve(Li(()=>c(n.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch(c){}return i===e.openCanceller&&n._close(),q(l)}).finally(()=>{e.openComplete=!0,r()})}function Ki(n){var e=o=>n.next(o),t=o=>n.throw(o),i=r(e),s=r(t);function r(o){return a=>{var l=o(a),c=l.value;return l.done?c:!c||typeof c.then!="function"?Z(c)?Promise.all(c).then(i,s):i(c):c.then(i,s)}}return r(e)()}function Hr(n,e,t){var i=arguments.length;if(i<2)throw new A.InvalidArgument("Too few arguments");for(var s=new Array(i-1);--i;)s[i-1]=arguments[i];t=s.pop();var r=In(s);return[n,r,t]}function es(n,e,t,i,s){return E.resolve().then(()=>{let r=_.transless||_,o=n._createTransaction(e,t,n._dbSchema,i),a={trans:o,transless:r};if(i)o.idbtrans=i.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(p){return p.name===zi.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>es(n,e,t,null,s))):q(p)}let l=qi(s);l&&je();let c,h=E.follow(()=>{if(c=s.call(o,o),c)if(l){var p=ve.bind(null,null);c.then(p,p)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Ki(c))},a);return(c&&typeof c.then=="function"?E.resolve(c).then(p=>o.active?p:q(new A.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(p=>(i&&o._resolve(),o._completion.then(()=>p))).catch(p=>(o._reject(p),q(p)))})}function Ot(n,e,t){let i=Z(n)?n.slice():[n];for(let s=0;s<t;++s)i.push(e);return i}function Br(n){return Y(K({},n),{table(e){let t=n.table(e),{schema:i}=t,s={},r=[];function o(d,u,v){let m=tt(d),y=s[m]=s[m]||[],g=d==null?0:typeof d=="string"?1:d.length,C=u>0,b=Y(K({},v),{isVirtual:C,keyTail:u,keyLength:g,extractKey:$i(d),unique:!C&&v.unique});if(y.push(b),b.isPrimaryKey||r.push(b),g>1){let f=g===2?d[0]:d.slice(0,g-1);o(f,u+1,v)}return y.sort((f,w)=>f.keyTail-w.keyTail),b}let a=o(i.primaryKey.keyPath,0,i.primaryKey);s[":id"]=[a];for(let d of i.indexes)o(d.keyPath,0,d);function l(d){let u=s[tt(d)];return u&&u[0]}function c(d,u){return{type:d.type===1?2:d.type,lower:Ot(d.lower,d.lowerOpen?n.MAX_KEY:n.MIN_KEY,u),lowerOpen:!0,upper:Ot(d.upper,d.upperOpen?n.MIN_KEY:n.MAX_KEY,u),upperOpen:!0}}function h(d){let u=d.query.index;return u.isVirtual?Y(K({},d),{query:{index:u,range:c(d.query.range,u.keyTail)}}):d}return Y(K({},t),{schema:Y(K({},i),{primaryKey:a,indexes:r,getIndexByKeyPath:l}),count(d){return t.count(h(d))},query(d){return t.query(h(d))},openCursor(d){let{keyTail:u,isVirtual:v,keyLength:m}=d.query.index;if(!v)return t.openCursor(d);function y(g){function C(f){f!=null?g.continue(Ot(f,d.reverse?n.MAX_KEY:n.MIN_KEY,u)):d.unique?g.continue(g.key.slice(0,m).concat(d.reverse?n.MIN_KEY:n.MAX_KEY,u)):g.continue()}return Object.create(g,{continue:{value:C},continuePrimaryKey:{value(f,w){g.continuePrimaryKey(Ot(f,n.MAX_KEY,u),w)}},primaryKey:{get(){return g.primaryKey}},key:{get(){let f=g.key;return m===1?f[0]:f.slice(0,m)}},value:{get(){return g.value}}})}return t.openCursor(h(d)).then(g=>g&&y(g))}})}})}var Wr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Br};function sn(n,e,t,i){return t=t||{},i=i||"",G(n).forEach(s=>{if(!ne(e,s))t[i+s]=void 0;else{var r=n[s],o=e[s];if(typeof r=="object"&&typeof o=="object"&&r&&o){let a=vi(r),l=vi(o);a!==l?t[i+s]=e[s]:a==="Object"?sn(r,o,t,i+s+"."):r!==o&&(t[i+s]=e[s])}else r!==o&&(t[i+s]=e[s])}}),G(e).forEach(s=>{ne(n,s)||(t[i+s]=e[s])}),t}function Gr(n,e){return e.type==="delete"?e.keys:e.keys||e.values.map(n.extractKey)}var qr={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>Y(K({},n),{table(e){let t=n.table(e),{primaryKey:i}=t.schema;return Y(K({},t),{mutate(r){let o=_.trans,{deleting:a,creating:l,updating:c}=o.table(e).hook;switch(r.type){case"add":if(l.fire===R)break;return o._promise("readwrite",()=>h(r),!0);case"put":if(l.fire===R&&c.fire===R)break;return o._promise("readwrite",()=>h(r),!0);case"delete":if(a.fire===R)break;return o._promise("readwrite",()=>h(r),!0);case"deleteRange":if(a.fire===R)break;return o._promise("readwrite",()=>p(r),!0)}return t.mutate(r);function h(u){let v=_.trans,m=u.keys||Gr(i,u);if(!m)throw new Error("Keys missing");return u=u.type==="add"||u.type==="put"?Y(K({},u),{keys:m}):K({},u),u.type!=="delete"&&(u.values=[...u.values]),u.keys&&(u.keys=[...u.keys]),jr(t,u,m).then(y=>{let g=m.map((C,b)=>{let f=y[b],w={onerror:null,onsuccess:null};if(u.type==="delete")a.fire.call(w,C,f,v);else if(u.type==="add"||f===void 0){let S=l.fire.call(w,C,u.values[b],v);C==null&&S!=null&&(C=S,u.keys[b]=C,i.outbound||se(u.values[b],i.keyPath,C))}else{let S=sn(f,u.values[b]),O=c.fire.call(w,S,C,f,v);if(O){let T=u.values[b];Object.keys(O).forEach(P=>{ne(T,P)?T[P]=O[P]:se(T,P,O[P])})}}return w});return t.mutate(u).then(({failures:C,results:b,numFailures:f,lastResult:w})=>{for(let S=0;S<m.length;++S){let O=b?b[S]:m[S],T=g[S];O==null?T.onerror&&T.onerror(C[S]):T.onsuccess&&T.onsuccess(u.type==="put"&&y[S]?u.values[S]:O)}return{failures:C,results:b,numFailures:f,lastResult:w}}).catch(C=>(g.forEach(b=>b.onerror&&b.onerror(C)),Promise.reject(C)))})}function p(u){return d(u.trans,u.range,1e4)}function d(u,v,m){return t.query({trans:u,values:!1,query:{index:i,range:v},limit:m}).then(({result:y})=>h({type:"delete",keys:y,trans:u}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):y.length<m?{failures:[],numFailures:0,lastResult:void 0}:d(u,Y(K({},v),{lower:y[y.length-1],lowerOpen:!0}),m)))}}})}})};function jr(n,e,t){return e.type==="add"?Promise.resolve([]):n.getMany({trans:e.trans,keys:t,cache:"immutable"})}function ts(n,e,t){try{if(!e||e.keys.length<n.length)return null;let i=[];for(let s=0,r=0;s<e.keys.length&&r<n.length;++s)ee(e.keys[s],n[r])===0&&(i.push(t?ct(e.values[s]):e.values[s]),++r);return i.length===n.length?i:null}catch(i){return null}}var zr={stack:"dbcore",level:-1,create:n=>({table:e=>{let t=n.table(e);return Y(K({},t),{getMany:i=>{if(!i.cache)return t.getMany(i);let s=ts(i.keys,i.trans._cache,i.cache==="clone");return s?E.resolve(s):t.getMany(i).then(r=>(i.trans._cache={keys:i.keys,values:i.cache==="clone"?ct(r):r},r))},mutate:i=>(i.type!=="add"&&(i.trans._cache=null),t.mutate(i))})}})};function rn(n){return!("from"in n)}var pe=function(n,e){if(this)te(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0});else{let t=new pe;return n&&"d"in n&&te(t,n),t}};We(pe.prototype,{add(n){return Kt(this,n),this},addKey(n){return lt(this,n,n),this},addKeys(n){return n.forEach(e=>lt(this,e,e)),this},[yi](){return Hi(this)}});function lt(n,e,t){let i=ee(e,t);if(isNaN(i))return;if(i>0)throw RangeError();if(rn(n))return te(n,{from:e,to:t,d:1});let s=n.l,r=n.r;if(ee(t,n.from)<0)return s?lt(s,e,t):n.l={from:e,to:t,d:1,l:null,r:null},On(n);if(ee(e,n.to)>0)return r?lt(r,e,t):n.r={from:e,to:t,d:1,l:null,r:null},On(n);ee(e,n.from)<0&&(n.from=e,n.l=null,n.d=r?r.d+1:1),ee(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);let o=!n.r;s&&!n.l&&Kt(n,s),r&&o&&Kt(n,r)}function Kt(n,e){function t(i,{from:s,to:r,l:o,r:a}){lt(i,s,r),o&&t(i,o),a&&t(i,a)}rn(e)||t(n,e)}function Ur(n,e){let t=Hi(e),i=t.next();if(i.done)return!1;let s=i.value,r=Hi(n),o=r.next(s.from),a=o.value;for(;!i.done&&!o.done;){if(ee(a.from,s.to)<=0&&ee(a.to,s.from)>=0)return!0;ee(s.from,a.from)<0?s=(i=t.next(a.from)).value:a=(o=r.next(s.from)).value}return!1}function Hi(n){let e=rn(n)?null:{s:0,n};return{next(t){let i=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,i)for(;e.n.l&&ee(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!i||ee(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function On(n){var e,t;let i=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),s=i>1?"r":i<-1?"l":"";if(s){let r=s==="r"?"l":"r",o=K({},n),a=n[s];n.from=a.from,n.to=a.to,n[s]=a[s],o[s]=a[r],n[r]=o,o.d=Tn(o)}n.d=Tn(n)}function Tn({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}var Yr={stack:"dbcore",level:0,create:n=>{let e=n.schema.name,t=new pe(n.MIN_KEY,n.MAX_KEY);return Y(K({},n),{table:i=>{let s=n.table(i),{schema:r}=s,{primaryKey:o}=r,{extractKey:a,outbound:l}=o,c=Y(K({},s),{mutate:d=>{let u=d.trans,v=u.mutatedParts||(u.mutatedParts={}),m=S=>{let O=`idb://${e}/${i}/${S}`;return v[O]||(v[O]=new pe)},y=m(""),g=m(":dels"),{type:C}=d,[b,f]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[],w=d.trans._cache;return s.mutate(d).then(S=>{if(Z(b)){C!=="delete"&&(b=S.results),y.addKeys(b);let O=ts(b,w);!O&&C!=="add"&&g.addKeys(b),(O||f)&&Xr(m,r,O,f)}else if(b){let O={from:b.lower,to:b.upper};g.add(O),y.add(O)}else y.add(t),g.add(t),r.indexes.forEach(O=>m(O.name).add(t));return S})}}),h=({query:{index:d,range:u}})=>{var v,m;return[d,new pe((v=u.lower)!==null&&v!==void 0?v:n.MIN_KEY,(m=u.upper)!==null&&m!==void 0?m:n.MAX_KEY)]},p={get:d=>[o,new pe(d.key)],getMany:d=>[o,new pe().addKeys(d.keys)],count:h,query:h,openCursor:h};return G(p).forEach(d=>{c[d]=function(u){let{subscr:v}=_;if(v){let m=f=>{let w=`idb://${e}/${i}/${f}`;return v[w]||(v[w]=new pe)},y=m(""),g=m(":dels"),[C,b]=p[d](u);if(m(C.name||"").add(b),!C.isPrimaryKey)if(d==="count")g.add(t);else{let f=d==="query"&&l&&u.values&&s.query(Y(K({},u),{values:!1}));return s[d].apply(this,arguments).then(w=>{if(d==="query"){if(l&&u.values)return f.then(({result:O})=>(y.addKeys(O),w));let S=u.values?w.result.map(a):w.result;u.values?y.addKeys(S):g.addKeys(S)}else if(d==="openCursor"){let S=w,O=u.values;return S&&Object.create(S,{key:{get(){return g.addKey(S.primaryKey),S.key}},primaryKey:{get(){let T=S.primaryKey;return g.addKey(T),T}},value:{get(){return O&&y.addKey(S.primaryKey),S.value}}})}return w})}}return s[d].apply(this,arguments)}}),c}})}};function Xr(n,e,t,i){function s(r){let o=n(r.name||"");function a(c){return c!=null?r.extractKey(c):null}let l=c=>r.multiEntry&&Z(c)?c.forEach(h=>o.addKey(h)):o.addKey(c);(t||i).forEach((c,h)=>{let p=t&&a(t[h]),d=i&&a(i[h]);ee(p,d)!==0&&(p!=null&&l(p),d!=null&&l(d))})}e.indexes.forEach(s)}var ae=class{constructor(e,t){this._middlewares={},this.verno=0;let i=ae.dependencies;this._options=t=K({addons:ae.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};let{addons:s}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:R,dbReadyPromise:null,cancelOpen:R,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};r.dbReadyPromise=new E(o=>{r.dbReadyResolve=o}),r.openCanceller=new E((o,a)=>{r.cancelOpen=a}),this._state=r,this.name=e,this.on=dt(this,"populate","blocked","versionchange","close",{ready:[Ui,R]}),this.on.ready.subscribe=An(this.on.ready.subscribe,o=>(a,l)=>{ae.vip(()=>{let c=this._state;if(c.openComplete)c.dbOpenError||E.resolve().then(a),l&&o(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),l&&o(a);else{o(a);let h=this;l||o(function p(){h.on.ready.unsubscribe(a),h.on.ready.unsubscribe(p)})}})}),this.Collection=dr(this),this.Table=cr(this),this.Transaction=wr(this),this.Version=Vr(this),this.WhereClause=br(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=at(t.IDBKeyRange),this._createTransaction=(o,a,l,c)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),et.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Wr),this.use(qr),this.use(Yr),this.use(zr),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(o=>o(this))}version(e){if(isNaN(e)||e<.1)throw new A.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new A.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let t=this._versions;var i=t.filter(s=>s._cfg.version===e)[0];return i||(i=new this.Version(e),t.push(i),t.sort(_r),i.stores({}),this._state.autoSchema=!1,i)}_whenReady(e){return this.idbdb&&(this._state.openComplete||_.letThrough||this._vip)?e():new E((t,i)=>{if(this._state.openComplete)return i(new A.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){i(new A.DatabaseClosed);return}this.open().catch(R)}this._state.dbReadyPromise.then(t,i)}).then(e)}use({stack:e,create:t,level:i,name:s}){s&&this.unuse({stack:e,name:s});let r=this._middlewares[e]||(this._middlewares[e]=[]);return r.push({stack:e,create:t,level:i==null?10:i,name:s}),r.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:i}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>i?s.create!==i:t?s.name!==t:!1)),this}open(){return Kr(this)}_close(){let e=this._state,t=et.indexOf(this);if(t>=0&&et.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(i){}this._novip.idbdb=null}e.dbReadyPromise=new E(i=>{e.dbReadyResolve=i}),e.openCanceller=new E((i,s)=>{e.cancelOpen=s})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new A.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,t=this._state;return new E((i,s)=>{let r=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=F(()=>{Fr(this._deps,this.name),i()}),o.onerror=oe(s),o.onblocked=this._fireOnBlocked};if(e)throw new A.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(r):r()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return G(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Hr.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,i){let s=_.trans;(!s||s.db!==this||e.indexOf("!")!==-1)&&(s=null);let r=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let o,a;try{if(a=t.map(c=>{var h=c instanceof this.Table?c.name:c;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e===hi)o=hi;else if(e=="rw"||e==pi)o=pi;else throw new A.InvalidArgument("Invalid transaction mode: "+e);if(s){if(s.mode===hi&&o===pi)if(r)s=null;else throw new A.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s&&a.forEach(c=>{if(s&&s.storeNames.indexOf(c)===-1)if(r)s=null;else throw new A.SubTransaction("Table "+c+" not included in parent transaction.")}),r&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(h,p)=>{p(c)}):q(c)}let l=es.bind(null,this,o,a,s,i);return s?s._promise(o,l,"lock"):_.trans?ze(_.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!ne(this._allTables,e))throw new A.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},Qr=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",Bi=class{constructor(e){this._subscribe=e}subscribe(e,t,i){return this._subscribe(!e||typeof e=="function"?{next:e,error:t,complete:i}:e)}[Qr](){return this}};function is(n,e){return G(e).forEach(t=>{let i=n[t]||(n[t]=new pe);Kt(i,e[t])}),n}function Jr(n){return new Bi(e=>{let t=qi(n);function i(u){t&&je();let v=()=>Oe(n,{subscr:u,trans:null}),m=_.trans?ze(_.transless,v):v();return t&&m.then(ve,ve),m}let s=!1,r={},o={},a={get closed(){return s},unsubscribe:()=>{s=!0,_e.storagemutated.unsubscribe(p)}};e.start&&e.start(a);let l=!1,c=!1;function h(){return G(o).some(u=>r[u]&&Ur(r[u],o[u]))}let p=u=>{is(r,u),h()&&d()},d=()=>{if(l||s)return;r={};let u={},v=i(u);c||(_e(ot,p),c=!0),l=!0,Promise.resolve(v).then(m=>{l=!1,!s&&(h()?d():(r={},o=u,e.next&&e.next(m)))},m=>{l=!1,e.error&&e.error(m),a.unsubscribe()})};return d(),a})}var Wi;try{Wi={indexedDB:N.indexedDB||N.mozIndexedDB||N.webkitIndexedDB||N.msIndexedDB,IDBKeyRange:N.IDBKeyRange||N.webkitIDBKeyRange}}catch(n){Wi={indexedDB:null,IDBKeyRange:null}}var De=ae;We(De,Y(K({},Wt),{delete(n){return new De(n,{addons:[]}).delete()},exists(n){return new De(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(n){try{return Rr(De.dependencies).then(n)}catch(e){return q(new A.MissingAPI)}},defineClass(){function n(e){te(this,e)}return n},ignoreTransaction(n){return _.trans?ze(_.transless,n):n()},vip:Li,async:function(n){return function(){try{var e=Ki(n.apply(this,arguments));return!e||typeof e.then!="function"?E.resolve(e):e}catch(t){return q(t)}}},spawn:function(n,e,t){try{var i=Ki(n.apply(t,e||[]));return!i||typeof i.then!="function"?E.resolve(i):i}catch(s){return q(s)}},currentTransaction:{get:()=>_.trans||null},waitFor:function(n,e){let t=E.resolve(typeof n=="function"?De.ignoreTransaction(n):n).timeout(e||6e4);return _.trans?_.trans.waitFor(t):t},Promise:E,debug:{get:()=>le,set:n=>{$n(n,n==="dexie"?()=>!0:Un)}},derive:Ge,extend:te,props:We,override:An,Events:dt,on:_e,liveQuery:Jr,extendObservabilitySet:is,getByKeyPath:me,setByKeyPath:se,delByKeyPath:Vs,shallowClone:Pn,deepClone:ct,getObjectDiff:sn,cmp:ee,asap:Mn,minKey:Mi,addons:[],connections:et,errnames:zi,dependencies:Wi,semVer:bn,version:bn.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,t*2))}));De.maxKey=at(De.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(_e(ot,n=>{if(!fe){let e;Gt?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Ee,!0,!0,n)):e=new CustomEvent(Ee,{detail:n}),fe=!0,dispatchEvent(e),fe=!1}}),addEventListener(Ee,({detail:n})=>{fe||Ht(n)}));function Ht(n){let e=fe;try{fe=!0,_e.storagemutated.fire(n)}finally{fe=e}}var fe=!1;if(typeof BroadcastChannel!="undefined"){let n=new BroadcastChannel(Ee);_e(ot,e=>{fe||n.postMessage(e)}),n.onmessage=e=>{e.data&&Ht(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){_e(ot,e=>{try{fe||(typeof localStorage!="undefined"&&localStorage.setItem(Ee,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:Ee,changedParts:e})))}catch(t){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Ee){let t=JSON.parse(e.newValue);t&&Ht(t.changedParts)}});let n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",Zr)}function Zr({data:n}){n&&n.type===Ee&&Ht(n.changedParts)}E.rejectionMapper=Gs;$n(le,Un);var ce="ch.der-tobi.obsidian-simple-mention",mt="mention",gt="me_mention",ns="simple-mention";var jt=class extends ae{constructor(){super(ns);this.version(1).stores({mentions:"name",occurences:"[path+lineNumber+lineFrom+startOccurence],mention, path",fileHashes:"path"})}};var ss=new RegExp('(^"[\\p{L}0-9-_, ]*$)|(^[\\p{L}0-9-_,]*$)',"u"),rs=new RegExp(/\[[ x]{1}\]/),os=new RegExp(/^\- \[x{1}\]/),as=new RegExp("```[a-zA-Z0-9\\w\\d\\s!@#$%^&*()_+-=\\[\\]{};':\"\\|,.<>/?]*```","gm");function zt(n,e){return new RegExp(to(n,e).source+"|"+on(n).source,"gmu")}function on(n){return new RegExp(`(\\B${n}[\\p{L}0-9-_,]+|\\B${n}"[\\p{L}0-9-_, ]+")`,"gmu")}function to(n,e){return new RegExp(`(\\B${n}${e})`,"gmu")}function Ue(n,e=0){let t=[...n.matchAll(as)],i=[];return t.map(s=>[e+s.index,e+s.index+s[0].length])}function Ye(n,e){return n.find(t=>t[0]<e&&t[1]>e)!=null}function an(n,e=0){let t=3735928559^e,i=1103547991^e;for(let s=0,r;s<n.length;s++)r=n.charCodeAt(s),t=Math.imul(t^r,2654435761),i=Math.imul(i^r,1597334677);return t=Math.imul(t^t>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}function ye(n,e){let t=function(s,r){return s.trim()!=""&&r.startsWith(s.trim())};for(let i of e.ignoredDirectories.split(","))if(t(i,n))return!0;return!1}var Ut=class{constructor(e,t,i){this.metadataCache=e;this.vault=t;this.settings=i;this.occurencesChangeSubscribers=[];this.metadataCacheEventReferences=[],this.vaultEventReferences=[],this.initialized=!1,this.mutex=new wt,this.db=new jt,this.triggerPhraseRegexp=new RegExp(this.settings.mentionTriggerPhrase)}init(){return D(this,null,function*(){this.db.open(),yield this.addMeMention(),this.loadVault(),this.initialized=!0,this.subscribeToCache(),this.subscribeToVault()})}subscribeToOccurencesChanges(e){this.occurencesChangeSubscribers.push(e)}getAllMentions(){return D(this,null,function*(){return yield this.db.mentions.toCollection().primaryKeys()})}getMentionAt(e,t,i){return D(this,null,function*(){let s=yield this.db.occurences.where("path").equals(e).and(r=>r.startOccurence<=i&&i<r.endOccurence&&r.lineNumber===t).first();if(s!=null)return s.mention})}getOccurencesByMention(e){return D(this,null,function*(){return yield this.db.occurences.where("mention").equals(e).toArray()})}unsubscribeAll(){this.occurencesChangeSubscribers=[]}unload(){for(let e of this.metadataCacheEventReferences)this.metadataCache.offref(e);for(let e of this.vaultEventReferences)this.vault.offref(e);this.db.close()}deleteDb(){this.db.delete()}addMeMention(){return D(this,null,function*(){let e={name:this.settings.meMentionName,isMe:!0};return this.db.mentions.put(e)})}loadVault(){return D(this,null,function*(){return this.mutex.runExclusive(()=>D(this,null,function*(){let t=(yield Promise.all(this.vault.getMarkdownFiles().map(r=>this.getIndexableFile(r)))).filter(r=>!r.isIgnored),i=t.filter(r=>r.reIndexNecessary),s=new vt.Notice(`Simple Mention:
`,36e5);for(let r=0;r<i.length;r++)yield this.indexFile(i[r]),s.setMessage(`Simple Mention:
Indexing mention `+(r+1)+"/"+i.length);s.setMessage(`Simple Mention:
Cleaning`),yield this.cleanUpFileHashes(t),yield this.cleanUpWithFileHashes(),s.hide(),new vt.Notice(`Simple Mention:
Indexing done`,1e3)}))})}subscribeToCache(){let e=this.metadataCache.on("resolved",this.cacheResolvedHandler.bind(this));this.metadataCacheEventReferences.push(e);let t=this.metadataCache.on("changed",this.cacheChangedHandler.bind(this));this.metadataCacheEventReferences.push(t)}subscribeToVault(){let e=this.vault.on("create",this.fileCreateHandler.bind(this));this.vaultEventReferences.push(e);let t=this.vault.on("delete",this.fileDeleteHandler.bind(this));this.vaultEventReferences.push(t);let i=this.vault.on("rename",this.fileRenameHandler.bind(this));this.vaultEventReferences.push(i)}getIndexableFile(e){return D(this,null,function*(){if(ye(e.path,this.settings))return{file:e,hash:null,fileContent:null,reIndexNecessary:!1,isIgnored:!0};let t=yield this.db.fileHashes.get(e.path);if(e.stat.mtime===(t==null?void 0:t.mtime))return{file:e,hash:null,fileContent:null,reIndexNecessary:!1,isIgnored:!1};let i=yield this.getIndexableFileBase(e);return i.isIgnored=!1,(t==null?void 0:t.hash)===i.hash?(i.reIndexNecessary=!1,i):(i.reIndexNecessary=!0,i)})}getIndexableFileBase(e){return D(this,null,function*(){let t=yield this.vault.read(e),i=an(t);return{file:e,fileContent:t,hash:i}})}indexFile(e){return D(this,null,function*(){let t=e.fileContent.split(`
`),i=ls.Text.of(t),s=e.file.path,r=yield this.db.occurences.where("path").equals(s).toArray(),o=yield this.db.mentions.where("name").anyOfIgnoreCase(r.map(u=>u.mention)).toArray(),a=this.getMentionOccurenceSnapshots(o),l=new Set;if(yield this.removeOccurencesOfPath(s),this.settings.ignoredDirectories&&ye(e.file.path,this.settings))return this.db.fileHashes.put({path:e.file.path,hash:e.hash,mtime:e.file.stat.mtime},e.file.path);if(!e.fileContent.contains(this.settings.mentionTriggerPhrase))return this.db.fileHashes.put({path:e.file.path,hash:e.hash,mtime:e.file.stat.mtime},e.file.path);let c=[];t.map((u,v)=>{let m=v+1;this.getMatches(u).forEach(y=>c.push({matchArray:y,lineNumber:m}))});let h=Ue(e.fileContent);c=c.filter(u=>!Ye(h,u.matchArray.index+i.line(u.lineNumber).from));let p=[];return yield Promise.all(c.map(u=>D(this,null,function*(){var g;let v=u.matchArray[0].replace(this.triggerPhraseRegexp,""),m=yield this.db.mentions.get(v);m==null&&(m={name:v,isMe:!1});let y={mention:m.name,lineFrom:i.line(u.lineNumber).from,lineTo:i.line(u.lineNumber).to,lineNumber:u.lineNumber,startOccurence:u.matchArray.index,endOccurence:u.matchArray.index+u.matchArray[0].length,path:s,text:u.matchArray.input,isTaskComplete:((g=u.matchArray.input.trimStart().match(os))==null?void 0:g.length)>0||!1};p.push(y),l.add(m)}))),yield this.db.occurences.bulkPut(p),yield Promise.all([...l.values()].map(u=>D(this,null,function*(){let v=yield this.db.occurences.where("mention").equals(u.name).toArray(),m=this.calculateOccurenceHash(v);u.occurencesHash=m}))),yield this.db.mentions.bulkPut([...l.values()]),l.forEach(u=>{this.handleOccurenceChangeNotification(u,a.get(u.name),e.file.path)}),[...o.values()].filter(u=>![...l.values()].includes(u)).forEach(u=>{this.notifyOccurencesChangeSubscribers(u,s)}),this.db.fileHashes.put({path:e.file.path,hash:e.hash,mtime:e.file.stat.mtime},e.file.path)})}cacheResolvedHandler(){return D(this,null,function*(){if(!this.initialized){this.initialized=!0;try{yield this.loadVault()}catch(e){console.error(e)}}})}cacheChangedHandler(e){this.mutex.runExclusive(()=>D(this,null,function*(){let t=yield this.getIndexableFile(e);!t.reIndexNecessary||(yield this.indexFile(t),yield this.cleanUpWithFileHashes())}))}fileCreateHandler(e){return D(this,null,function*(){this.isFileNotRelevantForCache(e)||this.mutex.runExclusive(()=>D(this,null,function*(){let t=yield this.getIndexableFile(e);!t.reIndexNecessary||(yield this.indexFile(t))}))})}fileDeleteHandler(e){this.isFileNotRelevantForCache(e)||this.mutex.runExclusive(()=>D(this,null,function*(){let t=yield this.getAffectedMentionsOfPath(e.path);yield this.removeOccurencesOfPath(e.path),yield this.cleanUpWithFileHashes(),t.forEach(i=>this.notifyOccurencesChangeSubscribers(i,e.path)),this.db.fileHashes.delete(e.path)}))}fileRenameHandler(e,t){this.isFileNotRelevantForCache(e)||this.mutex.runExclusive(()=>D(this,null,function*(){let i=yield this.getAffectedMentionsOfPath(t);this.db.occurences.where("path").equals(t).modify({path:e.path}),this.db.fileHashes.delete(t),i.forEach(r=>this.notifyOccurencesChangeSubscribers(r,e.path));let s=yield this.getIndexableFile(e);s.reIndexNecessary?yield this.indexFile(s):this.db.fileHashes.put({path:s.file.path,hash:s.hash,mtime:s.file.stat.mtime},s.file.path)}))}getMentionOccurenceSnapshots(e){let t=new Map;return e.forEach(i=>{t.set(i.name,i.occurencesHash)}),t}removeOccurencesOfPath(e){return D(this,null,function*(){yield this.db.occurences.where("path").equals(e).delete()})}getMatches(e){return[...e.matchAll(on(this.settings.mentionTriggerPhrase))]}calculateOccurenceHash(e){return an(JSON.stringify(e.map(t=>t.text).sort()))}handleOccurenceChangeNotification(e,t,i){(t==null||t!=null&&t!==e.occurencesHash)&&this.notifyOccurencesChangeSubscribers(e,i)}notifyOccurencesChangeSubscribers(e,t){this.occurencesChangeSubscribers!=null&&this.occurencesChangeSubscribers.forEach(i=>{i(e,t)})}isFileNotRelevantForCache(e){return!(e instanceof vt.TFile)||!e.name.toLowerCase().endsWith(".md")||e.extension!="md"}getAffectedMentionsOfPath(e){return D(this,null,function*(){let i=(yield this.db.occurences.where("path").equals(e).toArray()).map(s=>s.mention).filter((s,r,o)=>o.indexOf(s)===r);return this.db.mentions.bulkGet(i)})}cleanUpFileHashes(e){return D(this,null,function*(){let t=e.map(r=>r.file.path),s=(yield this.db.fileHashes.orderBy("path").uniqueKeys()).filter(r=>!t.includes(r));return this.db.fileHashes.where("path").anyOf(s).delete()})}cleanUpWithFileHashes(){return D(this,null,function*(){let e=yield this.db.fileHashes.orderBy("path").uniqueKeys(),i=(yield this.db.occurences.toArray()).map(a=>[a.path,a.lineNumber,a.lineFrom,a.startOccurence]).filter(a=>!e.includes(a[0]));yield this.db.occurences.bulkDelete(i);let s=yield this.db.occurences.orderBy("mention").uniqueKeys(),o=(yield this.db.mentions.toArray()).filter(a=>!a.isMe).map(a=>a.name).filter(a=>!s.includes(a));return this.db.mentions.bulkDelete(o)})}};var cs=require("@codemirror/state"),Yt=require("@codemirror/view");function us(n,e,t){return Yt.ViewPlugin.fromClass(class{constructor(s){this.decorations=this.addDecorations(s)}update(s){(s.docChanged||s.viewportChanged)&&(this.decorations=this.addDecorations(s.view))}addDecorations(s){let r=new cs.RangeSetBuilder;if(ye(n.workspace.getActiveFile().path,t))return r.finish();let o=e.regexp;for(let{from:a,to:l}of s.visibleRanges){let c=s.state.sliceDoc(a,l),h=[...c.matchAll(o)],p=Ue(c,a);h=h.filter(d=>!Ye(p,a+d.index)),h.forEach(d=>{r.add(a+d.index,a+d.index+d[0].length,Yt.Decoration.mark({class:d[1]!=null?gt:d[2]!=null?mt:""}))})}return r.finish()}destroy(){}},{decorations:s=>s.decorations,eventHandlers:{keydown:(s,r)=>{if(s.code==="Space"&&s.ctrlKey){let o=r.state.selection.asSingle().main.from,a=r.state.doc.lineAt(o),l=o-a.from,c=n.workspace.getActiveFile().path;e.keyDownHandler(a.number,l,c)}},mousedown:(s,r)=>{let o=s.target;if(s.ctrlKey&&o&&(s.target.hasClass(mt)||s.target.hasClass(gt))){let a=r.posAtCoords({x:s.x,y:s.y}),l=r.state.doc.lineAt(a),c=a-l.from,h=n.workspace.getActiveFile().path;e.keyDownHandler(l.number,c,h)}}}})}function hs(){return{iconId:"at",svgContent:'<path stroke="currentColor" fill="currentColor" d="M42.1465 31.1818L42.1466 31.1819L42.1573 31.178C44.3692 30.3753 47.2089 29.9641 50.6945 29.9641C55.4446 29.9641 58.9145 31.0529 61.1958 33.1427C63.4688 35.225 64.6468 38.3799 64.6468 42.7037V59.8495C64.6468 62.0655 65.2338 63.817 66.4928 65.0079C67.7465 66.194 69.5818 66.743 71.9057 66.743C74.7017 66.743 76.9231 65.7044 78.5078 63.6146C80.0422 61.591 81.1176 59.0917 81.7471 56.1329C82.3716 53.1983 82.6843 50.2912 82.6843 47.4122C82.6843 39.418 81.0684 33.1134 77.7756 28.5566C74.5738 23.9816 70.5141 20.7485 65.6 18.8751C60.7918 17.0186 55.9459 16.0882 51.065 16.0882C41.0105 16.0882 32.7594 19.237 26.3562 25.5586C19.951 31.8228 16.7596 39.9518 16.7596 49.8996C16.7596 57.0827 18.383 63.1935 21.657 68.2056C24.9155 73.1939 29.151 76.9571 34.3593 79.4852C39.6161 82.066 45.2486 83.3557 51.2502 83.3557C54.8136 83.3557 58.3752 82.8762 61.934 81.9185C64.682 81.2365 67.2027 80.2777 69.4938 79.0402C70.4372 78.5306 71.607 78.836 72.1009 79.7241C72.5591 80.5481 72.2864 81.5624 71.4952 81.9971C68.896 83.4252 65.994 84.5899 62.7868 85.4891L62.7868 85.489L62.7783 85.4915C58.8754 86.6613 54.7556 87.2474 50.4166 87.2474C43.3306 87.2474 36.8987 85.6663 31.1107 82.5108L31.1073 82.5089C25.3181 79.4112 20.7214 75.0897 17.3099 69.539C13.9053 63.9994 12.1965 57.6064 12.1965 50.3438C12.1965 43.3181 13.8437 36.9488 17.1322 31.2248L17.1333 31.2229C20.4247 25.4354 24.9634 20.8187 30.7567 17.3679C36.5369 13.9248 43.2085 12.1965 50.7871 12.1965C56.1549 12.1965 61.6533 13.2494 67.285 15.363L67.2866 15.3636C72.9403 17.4626 77.6821 20.9595 81.5175 25.8643C85.3197 30.7266 87.2474 37.2996 87.2474 45.6354C87.2474 49.3794 86.729 53.1554 85.6903 56.9647C84.6604 60.7413 82.9086 63.8926 80.441 66.4323L80.4368 66.4368C78.0809 68.9224 74.7965 70.1905 70.5163 70.1905C67.3265 70.1905 64.7892 69.4126 62.8603 67.9001C61.7771 67.0251 60.029 66.4349 58.324 66.2533C56.6311 66.073 54.8164 66.2788 53.6672 67.18C53.4775 67.3288 53.2835 67.4763 53.0854 67.6225C50.774 69.3278 47.9788 70.1905 44.6739 70.1905C41.9307 70.1905 39.1734 69.4192 36.3963 67.8558C33.7585 66.3709 32.3888 63.6687 32.3888 59.583C32.3888 56.3658 33.3134 54.002 35.0921 52.4044C36.9928 50.7533 39.379 49.6325 42.2697 49.0548C45.2636 48.4688 48.2878 48.1759 51.3429 48.1759C52.5699 48.1759 53.797 48.2053 55.0241 48.2641C57.2191 48.3694 59.0649 46.6218 59.0649 44.4209V44.214C59.0649 41.1284 58.4031 38.6162 57.0264 36.7281C55.5987 34.7094 53.1227 33.7669 49.7682 33.7669C47.1167 33.7669 44.6569 34.2606 42.3951 35.2536C40.9 35.9101 39.9438 37.3002 39.5552 38.8108L38.9064 41.3327C38.6525 42.3193 37.7127 42.9697 36.6999 42.8598C35.518 42.7314 34.6929 41.6279 34.904 40.4579L35.6103 36.5441C35.8917 34.9843 36.7777 33.6113 38.1331 32.8977C39.4115 32.2247 40.7492 31.6527 42.1465 31.1818ZM40.9717 64.7056L40.9806 64.7115L40.9897 64.717C42.7331 65.7698 44.6125 66.2988 46.619 66.2988C49.6513 66.2988 52.4481 65.2123 54.997 63.0732L54.9977 63.0726C57.6417 60.846 59.0005 57.9554 59.0648 54.4394L58.5676 54.4304H59.0649C59.0649 52.6155 57.6924 51.0649 55.8517 50.9583C55.5687 50.9419 55.2813 50.9271 54.9892 50.9137C53.6821 50.7946 52.4049 50.735 51.1576 50.735C47.9571 50.735 45.0545 51.2464 42.4571 52.2785C41.104 52.7859 40.0625 53.5983 39.3652 54.7237C38.6707 55.8447 38.3412 57.238 38.3412 58.8722C38.3412 61.5259 39.1842 63.5187 40.9717 64.7056Z"/>'}}var Xt=class{constructor(e,t,i){this.element=e;this.settings=t;this.ctx=i;this.subscribers=[];this.meMentionOrMentionRegex=void 0;this.meMentionOrMentionRegex=zt(this.settings.mentionTriggerPhrase,this.settings.meMentionName)}subscribeToMentionClick(e){this.subscribers.push(e)}addPreviewMentionStyle(){if(!ye(this.ctx.sourcePath,this.settings)&&this.element.firstChild instanceof Node){let e=this.getChildNodes(this.element);for(let t of e){if(t.parentElement.tagName==="CODE")continue;let i=this.getReplacementNodesOrNull(t.textContent,this.meMentionOrMentionRegex);i&&t.replaceWith(...i)}}}getChildNodes(e){let t=document.createTreeWalker(e.firstChild,NodeFilter.SHOW_TEXT,null),i=[],s;for(;s=t.nextNode();)i.push(s);return i}getReplacementNodesOrNull(e,t){let i=[...e.matchAll(t)];if(i.length>0){let s=[],r=e.substring(0,i[0].index);return s.push(r),i.forEach((o,a)=>{let l=o[1]!=null?gt:o[2]!=null?mt:"",c=this.surroundWithAnchorTag(o[0],l);s.push(c);let h=i[a+1]==null?e.length:i[a+1].index,p=o.index+o[0].length,d=e.substring(p,h);s.push(d)}),s}return null}surroundWithAnchorTag(e,t){let i=document.createElement("a");return i.addClass(t,"preview"),i.textContent=e,i.onClickEvent(s=>{this.subscribers.forEach(r=>r(e))}),i}};var Jt=require("obsidian");var Qt=class extends Jt.EditorSuggest{constructor(t,i,s){super(t);this.app=t;this.cache=i;this.settings=s}onTrigger(t,i,s){if(ye(s.path,this.settings))return;let r=Ue(i.getValue()),o=i.posToOffset(t);if(Ye(r,o))return;let a=i.getLine(t.line).substring(0,t.ch);if(!a.contains(this.settings.mentionTriggerPhrase))return;let l=a.split(this.settings.mentionTriggerPhrase).reverse()[0],c=[...a.matchAll(new RegExp(this.settings.mentionTriggerPhrase,"g"))].reverse()[0].index;return a.slice(c-1,c)!==" "&&a.slice(c-1,c)!==""||!ss.test(l)?void 0:{start:{ch:c,line:t.line},end:t,query:l}}getSuggestions(t){return D(this,null,function*(){let i=yield this.getMentionSuggestions(t);return i.length?i.sort(this.completitionComparer):[{label:t.query,value:t.query}].sort(this.completitionComparer)})}renderSuggestion(t,i){i.setText(t.label)}selectSuggestion(t,i){let s=this.app.workspace.getActiveViewOfType(Jt.MarkdownView),r=t.value+" ";!s||(s.editor.replaceRange(r,{ch:this.context.start.ch+this.settings.mentionTriggerPhrase.length,line:this.context.start.line},this.context.end),s.editor.setCursor({ch:this.context.start.ch+this.settings.mentionTriggerPhrase.length+r.length,line:this.context.start.line}))}getMentionSuggestions(t){return D(this,null,function*(){let i=[];for(let s of yield this.cache.getAllMentions())s.toLocaleLowerCase().contains(t.query.toLocaleLowerCase())&&i.push(s);return i.map(s=>({label:s.replace(/["]/g,""),value:s}))})}completitionComparer(t,i){return t.label.toLowerCase()<i.label.toLowerCase()?-1:t.label.toLowerCase()>i.label.toLowerCase()?1:0}};var X=class{static getString(e){return e||e===0?e.toString():""}static convertToBoolean(e,t=!1){let i;return e===!0||e==="true"?i=!0:e===!1||e==="false"?i=!1:i=t,i}static isEmpty(e){let t=!1;return e?Array.isArray(e)?e.length===0&&(t=!0):typeof e=="object"&&Object.keys(e).length===0&&(t=!0):t=!0,t}static isNotEmpty(e){return!this.isEmpty(e)}static removeItemFromArray(e,t,i=!1){if(!Array.isArray(e)||!e.length)return e;let s=i?[...e]:e,r=s.indexOf(t);return r!==-1&&s.splice(r,1),s}static removeArrayEmpty(e){return!Array.isArray(e)||!e.length?[]:e.filter(t=>!!t)}static getRandomInt(e,t=0){let i=Math.ceil(t),s=Math.floor(e);return Math.floor(Math.random()*(s-i-1))+i}};var x=class{static addClass(e,t){if(!e)return;let i=t.split(" ");x.getElements(e).forEach(s=>{s.classList.add(...i)})}static removeClass(e,t){if(!e)return;let i=t.split(" ");x.getElements(e).forEach(s=>{s.classList.remove(...i)})}static toggleClass(e,t,i){if(!e)return;let s;i!==void 0&&(s=Boolean(i)),x.getElements(e).forEach(r=>{r.classList.toggle(t,s)})}static hasClass(e,t){return e?e.classList.contains(t):!1}static hasEllipsis(e){return e?e.scrollWidth>e.offsetWidth:!1}static getData(e,t,i){if(!e)return;let s=e?e.dataset[t]:"";return i==="number"?s=parseFloat(s)||0:s==="true"?s=!0:s==="false"&&(s=!1),s}static setData(e,t,i){!e||(e.dataset[t]=i)}static setAttr(e,t,i){!e||e.setAttribute(t,i)}static setAttrFromEle(e,t,i,s){let r={};i.forEach(o=>{r[o]=e.getAttribute(o)}),i.forEach(o=>{let a=r[o];(a||s.indexOf(o)!==-1&&a==="")&&t.setAttribute(o,a)})}static setStyle(e,t,i){!e||(e.style[t]=i)}static setStyles(e,t){!e||!t||Object.keys(t).forEach(i=>{e.style[i]=t[i]})}static setAria(e,t,i){let s=t;s!=="role"&&(s=`aria-${s}`),e.setAttribute(s,i)}static getElements(e){return e?e.forEach===void 0?[e]:e:[]}static addEvent(e,t,i){if(!e)return;X.removeArrayEmpty(t.split(" ")).forEach(r=>{x.getElements(e).forEach(a=>{a.addEventListener(r,i)})})}static dispatchEvent(e,t,i=!1){if(!e)return;let s=x.getElements(e);setTimeout(()=>{s.forEach(r=>{r.dispatchEvent(new CustomEvent(t,{bubbles:i}))})},0)}static getAttributesText(e){let t="";return e&&Object.entries(e).forEach(([i,s])=>{s!==void 0&&(t+=` ${i}="${s}" `)}),t}static convertPropToDataAttr(e){return e?`data-${e}`.replace(/([A-Z])/g,"-$1").toLowerCase():""}};var io=48,no=40,so={13:"onEnterPress",38:"onUpArrowPress",40:"onDownArrowPress"},ps=["autofocus","disabled","multiple","required"],ro=["autofocus","class","disabled","id","multiple","name","placeholder","required"],Zt,oo=["additionalClasses","aliasKey","allOptionsSelectedText","allowNewOption","alwaysShowSelectedOptionsCount","ariaLabelledby","autoSelectFirstOption","clearButtonText","descriptionKey","disableAllOptionsSelectedText","disableOptionGroupCheckbox","disableSelectAll","disableValidation","dropboxWidth","dropboxWrapper","emptyValue","enableSecureText","hasOptionDescription","hideClearButton","hideValueTooltipOnSelectAll","keepAlwaysOpen","labelKey","markSearchResults","maxValues","maxWidth","moreText","noOfDisplayValues","noOptionsText","noSearchResultsText","optionHeight","optionSelectedText","optionsCount","optionsSelectedText","popupDropboxBreakpoint","popupPosition","position","search","searchByStartsWith","searchGroup","searchPlaceholderText","selectAllOnlyVisible","selectAllText","setValueAsArray","showDropboxAsPopup","showOptionsOnlyOnSearch","showSelectedOptionsFirst","showValueAsTags","silentInitialValueSet","textDirection","tooltipAlignment","tooltipFontSize","tooltipMaxWidth","updatePositionThrottle","useGroupValue","valueKey","zIndex"],V=class{constructor(e){try{this.createSecureTextElements(),this.setProps(e),this.setDisabledOptions(e.disabledOptions),this.setOptions(e.options),this.render()}catch(t){console.warn("Couldn't initiate Virtual Select"),console.error(t)}}render(){if(!this.$ele)return;let{uniqueId:e}=this,t="vscomp-wrapper",i=this.getTooltipAttrText(this.placeholder,!0,!0),s=this.getTooltipAttrText(this.clearButtonText),r=this.ariaLabelledby?`aria-labelledby="${this.ariaLabelledby}"`:"",o=!1;this.additionalClasses&&(t+=` ${this.additionalClasses}`),this.multiple&&(t+=" multiple",this.disableSelectAll||(t+=" has-select-all")),this.hideClearButton||(t+=" has-clear-button"),this.keepAlwaysOpen?(t+=" keep-always-open",o=!0):t+=" closed",this.showAsPopup&&(t+=" show-as-popup"),this.hasSearch&&(t+=" has-search-input"),this.showValueAsTags&&(t+=" show-value-as-tags"),this.textDirection&&(t+=` text-direction-${this.textDirection}`),this.popupPosition&&(t+=` popup-position-${this.popupPosition.toLowerCase()}`);let a=`<div id="vscomp-ele-wrapper-${e}" class="vscomp-ele-wrapper ${t}" tabindex="0"
        role="combobox" aria-haspopup="listbox" aria-controls="vscomp-dropbox-container-${e}"
        aria-expanded="${o}" ${r}
      >
        <input type="hidden" name="${this.name}" class="vscomp-hidden-input">

        <div class="vscomp-toggle-button">
          <div class="vscomp-value" ${i}>
            ${this.placeholder}
          </div>

          <div class="vscomp-arrow"></div>

          <div class="vscomp-clear-button toggle-button-child" ${s}>
            <i class="vscomp-clear-icon"></i>
          </div>
        </div>

        ${this.renderDropbox({wrapperClasses:t})}
      </div>`;this.$ele.innerHTML=a,this.$body=document.querySelector("body"),this.$wrapper=this.$ele.querySelector(".vscomp-wrapper"),this.hasDropboxWrapper?(this.$allWrappers=[this.$wrapper,this.$dropboxWrapper],this.$dropboxContainer=this.$dropboxWrapper.querySelector(".vscomp-dropbox-container"),x.addClass(this.$dropboxContainer,"pop-comp-wrapper")):(this.$allWrappers=[this.$wrapper],this.$dropboxContainer=this.$wrapper.querySelector(".vscomp-dropbox-container")),this.$toggleButton=this.$ele.querySelector(".vscomp-toggle-button"),this.$clearButton=this.$ele.querySelector(".vscomp-clear-button"),this.$valueText=this.$ele.querySelector(".vscomp-value"),this.$hiddenInput=this.$ele.querySelector(".vscomp-hidden-input"),this.$dropbox=this.$dropboxContainer.querySelector(".vscomp-dropbox"),this.$dropboxCloseButton=this.$dropboxContainer.querySelector(".vscomp-dropbox-close-button"),this.$search=this.$dropboxContainer.querySelector(".vscomp-search-wrapper"),this.$optionsContainer=this.$dropboxContainer.querySelector(".vscomp-options-container"),this.$optionsList=this.$dropboxContainer.querySelector(".vscomp-options-list"),this.$options=this.$dropboxContainer.querySelector(".vscomp-options"),this.$noOptions=this.$dropboxContainer.querySelector(".vscomp-no-options"),this.$noSearchResults=this.$dropboxContainer.querySelector(".vscomp-no-search-results"),this.afterRenderWrapper()}renderDropbox({wrapperClasses:e}){let t=this.dropboxWrapper!=="self"?document.querySelector(this.dropboxWrapper):null,i=`<div id="vscomp-dropbox-container-${this.uniqueId}" role="listbox" class="vscomp-dropbox-container">
        <div class="vscomp-dropbox">
          <div class="vscomp-search-wrapper"></div>

          <div class="vscomp-options-container">
            <div class="vscomp-options-loader"></div>

            <div class="vscomp-options-list">
              <div class="vscomp-options"></div>
            </div>
          </div>

          <div class="vscomp-options-bottom-freezer"></div>
          <div class="vscomp-no-options">${this.noOptionsText}</div>
          <div class="vscomp-no-search-results">${this.noSearchResultsText}</div>

          <span class="vscomp-dropbox-close-button"><i class="vscomp-clear-icon"></i></span>
        </div>
      </div>`;if(t){let s=document.createElement("div");return this.$dropboxWrapper=s,this.hasDropboxWrapper=!0,s.innerHTML=i,t.appendChild(s),x.addClass(s,`vscomp-dropbox-wrapper ${e}`),""}return this.hasDropboxWrapper=!1,i}renderOptions(){let e="",t=this.getVisibleOptions(),i="",s="",r=!!(this.markSearchResults&&this.searchValue),o,{labelRenderer:a,disableOptionGroupCheckbox:l,uniqueId:c,searchGroup:h}=this,p=typeof a=="function",{convertToBoolean:d}=X;r&&(o=new RegExp(`(${this.searchValue})`,"gi")),this.multiple&&(i='<span class="checkbox-icon"></span>'),this.allowNewOption&&(s=`<span class="vscomp-new-option-icon" ${this.getTooltipAttrText("New Option")}></span>`),t.forEach(u=>{let{index:v}=u,m,y="vscomp-option",g=this.getTooltipAttrText("",!0,!0),C=i,b="",f="",w="",S=d(u.isSelected),O="";u.isFocused&&(y+=" focused"),u.isDisabled&&(y+=" disabled",O='aria-disabled="true"'),u.isGroupTitle&&(y+=" group-title",l&&(C="")),S&&(y+=" selected"),u.isGroupOption&&(y+=" group-option",w=`data-group-index="${u.groupIndex}"`),p?m=a(u):m=u.label,u.description&&(f=`<div class="vscomp-option-description" ${g}>${u.description}</div>`),u.isCurrentNew?(y+=" current-new",b+=s):r&&(!u.isGroupTitle||h)&&(m=m.replace(o,"<mark>$1</mark>")),e+=`<div role="option" aria-selected="${S}" id="vscomp-option-${c}-${v}"
          class="${y}" data-value="${u.value}" data-index="${v}" data-visible-index="${u.visibleIndex}"
          ${w} ${O}
        >
          ${C}
          <span class="vscomp-option-text" ${g}>
            ${m}
          </span>
          ${f}
          ${b}
        </div>`}),this.$options.innerHTML=e,this.$visibleOptions=this.$options.querySelectorAll(".vscomp-option"),this.afterRenderOptions()}renderSearch(){if(!this.hasSearchContainer)return;let e="",t="";this.multiple&&!this.disableSelectAll&&(e=`<span class="vscomp-toggle-all-button">
          <span class="checkbox-icon vscomp-toggle-all-checkbox"></span>
          <span class="vscomp-toggle-all-label">${this.selectAllText}</span>
        </span>`),this.hasSearch&&(t=`<input type="text" class="vscomp-search-input" placeholder="${this.searchPlaceholderText}">
      <span class="vscomp-search-clear">&times;</span>`);let i=`<div class="vscomp-search-container">
        ${e}
        ${t}
      </div>`;this.$search.innerHTML=i,this.$searchInput=this.$dropboxContainer.querySelector(".vscomp-search-input"),this.$searchClear=this.$dropboxContainer.querySelector(".vscomp-search-clear"),this.$toggleAllButton=this.$dropboxContainer.querySelector(".vscomp-toggle-all-button"),this.$toggleAllCheckbox=this.$dropboxContainer.querySelector(".vscomp-toggle-all-checkbox"),this.addEvent(this.$searchInput,"input","onSearch"),this.addEvent(this.$searchClear,"click","onSearchClear"),this.addEvent(this.$toggleAllButton,"click","onToggleAllOptions")}addEvents(){this.addEvent(document,"click","onDocumentClick"),this.addEvent(this.$allWrappers,"keydown","onKeyDown"),this.addEvent(this.$toggleButton,"click","onToggleButtonClick"),this.addEvent(this.$clearButton,"click","onClearButtonClick"),this.addEvent(this.$dropboxContainer,"click","onDropboxContainerClick"),this.addEvent(this.$dropboxCloseButton,"click","onDropboxCloseButtonClick"),this.addEvent(this.$optionsContainer,"scroll","onOptionsScroll"),this.addEvent(this.$options,"click","onOptionsClick"),this.addEvent(this.$options,"mouseover","onOptionsMouseOver"),this.addEvent(this.$options,"touchmove","onOptionsTouchMove"),this.addMutationObserver()}addEvent(e,t,i){if(!e)return;X.removeArrayEmpty(t.split(" ")).forEach(r=>{let o=`${i}-${r}`,a=this.events[o];a||(a=this[i].bind(this),this.events[o]=a),x.addEvent(e,r,a)})}onDocumentClick(e){let t=e.target.closest(".vscomp-wrapper");t!==this.$wrapper&&t!==this.$dropboxWrapper&&this.isOpened()&&this.closeDropbox()}onKeyDown(e){let t=e.which||e.keyCode,i=so[t];i&&this[i](e)}onEnterPress(e){e.preventDefault(),this.isOpened()?this.selectFocusedOption():this.openDropbox()}onDownArrowPress(e){e.preventDefault(),this.isOpened()?this.focusOption({direction:"next"}):this.openDropbox()}onUpArrowPress(e){e.preventDefault(),this.isOpened()?this.focusOption({direction:"previous"}):this.openDropbox()}onToggleButtonClick(e){let t=e.target;t.closest(".vscomp-value-tag-clear-button")?this.removeValue(t.closest(".vscomp-value-tag")):t.closest(".toggle-button-child")||this.toggleDropbox()}onClearButtonClick(){this.reset()}onOptionsScroll(){this.setVisibleOptions()}onOptionsClick(e){let t=e.target.closest(".vscomp-option");t&&!x.hasClass(t,"disabled")&&(x.hasClass(t,"group-title")?this.onGroupTitleClick(t):this.selectOption(t,{event:e}))}onGroupTitleClick(e){if(!e||!this.multiple||this.disableOptionGroupCheckbox)return;let t=!x.hasClass(e,"selected");this.toggleGroupTitleCheckbox(e,t),this.toggleGroupOptions(e,t)}onDropboxContainerClick(e){e.target.closest(".vscomp-dropbox")||this.closeDropbox()}onDropboxCloseButtonClick(){this.closeDropbox()}onOptionsMouseOver(e){let t=e.target.closest(".vscomp-option");t&&this.isOpened()&&(x.hasClass(t,"disabled")||x.hasClass(t,"group-title")?this.removeOptionFocus():this.focusOption({$option:t}))}onOptionsTouchMove(){this.removeOptionFocus()}onSearch(e){e.stopPropagation(),this.setSearchValue(e.target.value,!0)}onSearchClear(){this.setSearchValue(""),this.focusSearchInput()}onToggleAllOptions(){this.toggleAllOptions()}onResize(){this.setOptionsContainerHeight(!0)}addMutationObserver(){if(!this.hasDropboxWrapper)return;let e=this.$ele;this.mutationObserver=new MutationObserver(t=>{t.some(i=>{let r=[...i.removedNodes].some(o=>!!(o===e||o.contains(e)));return r&&this.destroy(),r})}),this.mutationObserver.observe(document.querySelector("body"),{childList:!0,subtree:!0})}beforeValueSet(e){this.toggleAllOptionsClass(e?!1:void 0)}beforeSelectNewValue(){let e=this.getNewOption(),t=e.index;this.newValues.push(e.value),this.setOptionProp(t,"isCurrentNew",!1),this.setOptionProp(t,"isNew",!0),setTimeout(()=>{this.setSearchValue(""),this.focusSearchInput()},0)}afterRenderWrapper(){x.addClass(this.$ele,"vscomp-ele"),this.renderSearch(),this.setEleStyles(),this.setDropboxStyles(),this.setOptionsHeight(),this.setVisibleOptions(),this.setOptionsContainerHeight(),this.addEvents(),this.setEleProps(),!this.keepAlwaysOpen&&!this.showAsPopup&&this.initDropboxPopover(),this.initialSelectedValue?this.setValueMethod(this.initialSelectedValue,this.silentInitialValueSet):this.autoSelectFirstOption&&this.visibleOptions.length&&this.setValueMethod(this.visibleOptions[0].value,this.silentInitialValueSet),this.showOptionsOnlyOnSearch&&this.setSearchValue("",!1,!0),this.initialDisabled&&this.disable(),this.autofocus&&this.focus()}afterRenderOptions(){let e=this.getVisibleOptions(),t=!this.options.length&&!this.hasServerSearch,i=!t&&!e.length;(!this.allowNewOption||this.hasServerSearch||this.showOptionsOnlyOnSearch)&&x.toggleClass(this.$allWrappers,"has-no-search-results",i),x.toggleClass(this.$allWrappers,"has-no-options",t),this.setOptionAttr(),this.setOptionsPosition(),this.setOptionsTooltip()}afterSetOptionsContainerHeight(e){e&&this.showAsPopup&&this.setVisibleOptions()}afterSetSearchValue(){this.hasServerSearch?this.serverSearch():this.setVisibleOptionsCount(),this.selectAllOnlyVisible&&this.toggleAllOptionsClass(),this.focusOption({focusFirst:!0})}afterSetVisibleOptionsCount(){this.scrollToTop(),this.setOptionsHeight(),this.setVisibleOptions(),this.updatePosition()}afterValueSet(){this.scrollToTop(),this.setSearchValue(""),this.renderOptions()}afterSetOptions(e){e&&this.setSelectedProp(),this.setOptionsHeight(),this.setVisibleOptions(),this.showOptionsOnlyOnSearch&&this.setSearchValue("",!1,!0),e||this.reset()}setProps(e){let t=this.setDefaultProps(e);this.setPropsFromElementAttr(t);let{convertToBoolean:i}=X;this.$ele=t.ele,this.dropboxWrapper=t.dropboxWrapper,this.valueKey=t.valueKey,this.labelKey=t.labelKey,this.descriptionKey=t.descriptionKey,this.aliasKey=t.aliasKey,this.optionHeightText=t.optionHeight,this.optionHeight=parseFloat(this.optionHeightText),this.multiple=i(t.multiple),this.hasSearch=i(t.search),this.searchByStartsWith=i(t.searchByStartsWith),this.searchGroup=i(t.searchGroup),this.hideClearButton=i(t.hideClearButton),this.autoSelectFirstOption=i(t.autoSelectFirstOption),this.hasOptionDescription=i(t.hasOptionDescription),this.silentInitialValueSet=i(t.silentInitialValueSet),this.allowNewOption=i(t.allowNewOption),this.markSearchResults=i(t.markSearchResults),this.showSelectedOptionsFirst=i(t.showSelectedOptionsFirst),this.disableSelectAll=i(t.disableSelectAll),this.keepAlwaysOpen=i(t.keepAlwaysOpen),this.showDropboxAsPopup=i(t.showDropboxAsPopup),this.hideValueTooltipOnSelectAll=i(t.hideValueTooltipOnSelectAll),this.showOptionsOnlyOnSearch=i(t.showOptionsOnlyOnSearch),this.selectAllOnlyVisible=i(t.selectAllOnlyVisible),this.alwaysShowSelectedOptionsCount=i(t.alwaysShowSelectedOptionsCount),this.disableAllOptionsSelectedText=i(t.disableAllOptionsSelectedText),this.showValueAsTags=i(t.showValueAsTags),this.disableOptionGroupCheckbox=i(t.disableOptionGroupCheckbox),this.enableSecureText=i(t.enableSecureText),this.setValueAsArray=i(t.setValueAsArray),this.disableValidation=i(t.disableValidation),this.initialDisabled=i(t.disabled),this.required=i(t.required),this.autofocus=i(t.autofocus),this.useGroupValue=i(t.useGroupValue),this.noOptionsText=t.noOptionsText,this.noSearchResultsText=t.noSearchResultsText,this.selectAllText=t.selectAllText,this.searchPlaceholderText=t.searchPlaceholderText,this.optionsSelectedText=t.optionsSelectedText,this.optionSelectedText=t.optionSelectedText,this.allOptionsSelectedText=t.allOptionsSelectedText,this.clearButtonText=t.clearButtonText,this.moreText=t.moreText,this.placeholder=t.placeholder,this.position=t.position,this.textDirection=t.textDirection,this.dropboxWidth=t.dropboxWidth,this.tooltipFontSize=t.tooltipFontSize,this.tooltipAlignment=t.tooltipAlignment,this.tooltipMaxWidth=t.tooltipMaxWidth,this.updatePositionThrottle=t.updatePositionThrottle,this.noOfDisplayValues=parseInt(t.noOfDisplayValues),this.zIndex=parseInt(t.zIndex),this.maxValues=parseInt(t.maxValues),this.name=this.secureText(t.name),this.additionalClasses=t.additionalClasses,this.popupDropboxBreakpoint=t.popupDropboxBreakpoint,this.popupPosition=t.popupPosition,this.onServerSearch=t.onServerSearch,this.labelRenderer=t.labelRenderer,this.initialSelectedValue=t.selectedValue===0?"0":t.selectedValue,this.emptyValue=t.emptyValue,this.ariaLabelledby=t.ariaLabelledby,this.maxWidth=t.maxWidth,this.selectedValues=[],this.selectedOptions=[],this.newValues=[],this.events={},this.tooltipEnterDelay=200,this.searchValue="",this.searchValueOriginal="",this.isAllSelected=!1,(t.search===void 0&&this.multiple||this.allowNewOption||this.showOptionsOnlyOnSearch)&&(this.hasSearch=!0),this.hasServerSearch=typeof this.onServerSearch=="function",(this.maxValues||this.hasServerSearch||this.showOptionsOnlyOnSearch)&&(this.disableSelectAll=!0,this.disableOptionGroupCheckbox=!0),this.keepAlwaysOpen&&(this.dropboxWrapper="self"),this.showAsPopup=this.showDropboxAsPopup&&!this.keepAlwaysOpen&&window.innerWidth<=parseFloat(this.popupDropboxBreakpoint),this.hasSearchContainer=this.hasSearch||this.multiple&&!this.disableSelectAll,this.optionsCount=this.getOptionsCount(t.optionsCount),this.halfOptionsCount=Math.ceil(this.optionsCount/2),this.optionsHeight=this.getOptionsHeight(),this.uniqueId=this.getUniqueId()}setDefaultProps(e){let t={dropboxWrapper:"self",valueKey:"value",labelKey:"label",descriptionKey:"description",aliasKey:"alias",optionsCount:5,noOfDisplayValues:50,optionHeight:"40px",noOptionsText:"No options found",noSearchResultsText:"No results found",selectAllText:"Select All",searchPlaceholderText:"Search...",clearButtonText:"Clear",moreText:"more...",optionsSelectedText:"options selected",optionSelectedText:"option selected",allOptionsSelectedText:"All",placeholder:"Select",position:"bottom left",zIndex:e.keepAlwaysOpen?1:2,tooltipFontSize:"14px",tooltipAlignment:"center",tooltipMaxWidth:"300px",updatePositionThrottle:100,name:"",additionalClasses:"",maxValues:0,showDropboxAsPopup:!0,popupDropboxBreakpoint:"576px",popupPosition:"center",hideValueTooltipOnSelectAll:!0,emptyValue:""};return e.hasOptionDescription&&(t.optionsCount=4,t.optionHeight="50px"),Object.assign(t,e)}setPropsFromElementAttr(e){let t=e.ele;Object.keys(Zt).forEach(i=>{let s=t.getAttribute(i);ps.indexOf(i)!==-1&&(s===""||s==="true")&&(s=!0),s&&(e[Zt[i]]=s)})}setEleProps(){let{$ele:e}=this;e.virtualSelect=this,e.value=this.multiple?[]:"",e.name=this.name,e.disabled=!1,e.required=this.required,e.autofocus=this.autofocus,e.multiple=this.multiple,e.form=e.closest("form"),e.reset=V.reset,e.setValue=V.setValueMethod,e.setOptions=V.setOptionsMethod,e.setDisabledOptions=V.setDisabledOptionsMethod,e.toggleSelectAll=V.toggleSelectAll,e.isAllSelected=V.isAllSelected,e.addOption=V.addOptionMethod,e.getNewValue=V.getNewValueMethod,e.getDisplayValue=V.getDisplayValueMethod,e.getSelectedOptions=V.getSelectedOptionsMethod,e.open=V.openMethod,e.close=V.closeMethod,e.focus=V.focusMethod,e.enable=V.enableMethod,e.disable=V.disableMethod,e.destroy=V.destroyMethod,e.validate=V.validateMethod,e.toggleRequired=V.toggleRequiredMethod,this.hasDropboxWrapper&&(this.$dropboxWrapper.virtualSelect=this)}setValueMethod(e,t){let i={},s={},r=[],o=this.multiple,a=e;if(a){if(Array.isArray(a)||(a=[a]),o){let{maxValues:l}=this;l&&a.length>l&&a.splice(l)}else a.length>1&&(a=[a[0]]);a=a.map(l=>l||l===0?l.toString():""),this.useGroupValue&&(a=this.setGroupOptionsValue(a)),a.forEach((l,c)=>{i[l]=!0,s[l]=c}),this.allowNewOption&&a&&this.setNewOptionsFromValue(a)}this.options.forEach(l=>{i[l.value]===!0&&!l.isDisabled&&!l.isGroupTitle?(l.isSelected=!0,r.push(l.value)):l.isSelected=!1}),o?(this.hasOptionGroup&&this.setGroupsSelectedProp(),r.sort((l,c)=>s[l]-s[c])):[r]=r,this.beforeValueSet(),this.setValue(r,{disableEvent:t}),this.afterValueSet()}setGroupOptionsValue(e){let t=[],i={},s={};return e.forEach(r=>{s[r]=!0}),this.options.forEach(r=>{let{value:o}=r,a=s[o]===!0;r.isGroupTitle?a&&(i[r.index]=!0):(a||i[r.groupIndex])&&t.push(o)}),t}setGroupsSelectedProp(){let e=this.isAllGroupOptionsSelected.bind(this);this.options.forEach(t=>{t.isGroupTitle&&(t.isSelected=e(t.index))})}setOptionsMethod(e,t){this.setOptions(e),this.afterSetOptions(t)}setDisabledOptionsMethod(e,t=!1){this.setDisabledOptions(e,!0),t||(this.setValueMethod(null),this.toggleAllOptionsClass()),this.setVisibleOptions()}setDisabledOptions(e,t=!1){let i=[];if(!e)t&&this.options.forEach(s=>(s.isDisabled=!1,s));else if(e===!0)t&&this.options.forEach(s=>(s.isDisabled=!0,i.push(s.value),s));else{i=e.map(r=>r.toString());let s={};i.forEach(r=>{s[r]=!0}),t&&this.options.forEach(r=>(r.isDisabled=s[r.value]===!0,r))}this.disabledOptions=i}setOptions(e=[]){let t=[],i=this.disabledOptions.length,{valueKey:s,labelKey:r,descriptionKey:o,aliasKey:a,hasOptionDescription:l}=this,{getString:c,convertToBoolean:h}=X,p=this.secureText.bind(this),d=this.getAlias.bind(this),u=0,v=!1,m={},y=!1;this.disabledOptions.forEach(f=>{m[f]=!0});let g=f=>{typeof f!="object"&&(f={value:f,label:f});let w=p(c(f[s])),S=f.options,O=!!S,T={index:u,value:w,label:p(c(f[r])),alias:d(f[a]),isVisible:h(f.isVisible,!0),isNew:f.isNew||!1,isGroupTitle:O};if(!y&&w===""&&(y=!0),i&&(T.isDisabled=m[w]===!0),f.isGroupOption&&(T.isGroupOption=!0,T.groupIndex=f.groupIndex),l&&(T.description=p(c(f[o]))),f.customData&&(T.customData=f.customData),t.push(T),u+=1,O){let P=T.index;v=!0,S.forEach($=>{$.isGroupOption=!0,$.groupIndex=P,g($)})}};e.forEach(g);let C=t.length,{$ele:b}=this;b.options=t,b.length=C,this.options=t,this.visibleOptionsCount=C,this.lastOptionIndex=C-1,this.newValues=[],this.hasOptionGroup=v,this.hasEmptyValueOption=y,this.setSortedOptions()}setServerOptions(e=[]){this.setOptionsMethod(e,!0);let{selectedOptions:t}=this,i=this.options,s=!1;if(t.length){let r={};s=!0,i.forEach(o=>{r[o.value]=!0}),t.forEach(o=>{r[o.value]===!1&&(o.isVisible=!1,i.push(o))}),this.setOptionsMethod(i,!0)}this.allowNewOption&&this.searchValue&&(i.some(o=>o.label.toLowerCase()===this.searchValue)||(s=!0,this.setNewOption())),s?(this.setVisibleOptionsCount(),this.multiple&&this.toggleAllOptionsClass(),this.setValueText()):this.updatePosition(),x.removeClass(this.$allWrappers,"server-searching")}setSelectedOptions(){this.selectedOptions=this.options.filter(e=>e.isSelected)}setSortedOptions(){let e=[...this.options];this.showSelectedOptionsFirst&&this.selectedValues.length&&(this.hasOptionGroup?e=this.sortOptionsGroup(e):e=this.sortOptions(e)),this.sortedOptions=e}setVisibleOptions(){let e=[...this.sortedOptions],t=this.optionsCount*2,i=this.getVisibleStartIndex(),s=this.getNewOption(),r=i+t-1,o=0;s&&(s.visibleIndex=o,o+=1),e=e.filter(a=>{let l=!1;return a.isVisible&&!a.isCurrentNew&&(l=o>=i&&o<=r,a.visibleIndex=o,o+=1),l}),s&&(e=[s,...e]),this.visibleOptions=e,this.renderOptions()}setOptionsPosition(e){let t=(e||this.getVisibleStartIndex())*this.optionHeight;this.$options.style.transform=`translate3d(0, ${t}px, 0)`,x.setData(this.$options,"top",t)}setOptionsTooltip(){let e=this.getVisibleOptions(),{hasOptionDescription:t}=this;e.forEach(i=>{let s=this.$dropboxContainer.querySelector(`.vscomp-option[data-index="${i.index}"]`);x.setData(s.querySelector(".vscomp-option-text"),"tooltip",i.label),t&&x.setData(s.querySelector(".vscomp-option-description"),"tooltip",i.description)})}setValue(e,{disableEvent:t=!1,disableValidation:i=!1}={}){this.hasEmptyValueOption&&e===""||e?Array.isArray(e)?this.selectedValues=[...e]:this.selectedValues=[e]:this.selectedValues=[];let r=this.getValue();this.$ele.value=r,this.$hiddenInput.value=this.getInputValue(r),this.isMaxValuesSelected=!!(this.maxValues&&this.maxValues<=this.selectedValues.length),this.toggleAllOptionsClass(),this.setValueText(),x.toggleClass(this.$allWrappers,"has-value",X.isNotEmpty(this.selectedValues)),x.toggleClass(this.$allWrappers,"max-value-selected",this.isMaxValuesSelected),i||this.validate(),t||x.dispatchEvent(this.$ele,"change",!0)}setValueText(){let{multiple:e,selectedValues:t,noOfDisplayValues:i,showValueAsTags:s,$valueText:r}=this,o=[],a=[],l=t.length,c=0,h=this.isAllSelected&&!this.hasServerSearch&&!this.disableAllOptionsSelectedText&&!s;if(h&&this.hideValueTooltipOnSelectAll)r.innerHTML=`${this.allOptionsSelectedText} (${l})`;else{this.getSelectedOptions({fullDetails:!0,keepSelectionOrder:!0}).some(m=>{if(m.isCurrentNew)return!1;if(c>=i)return!0;let{label:y}=m;if(o.push(y),c+=1,s){let g=`<span class="vscomp-value-tag" data-index="${m.index}">
              <span class="vscomp-value-tag-content">${y}</span>
              <span class="vscomp-value-tag-clear-button">
                <i class="vscomp-clear-icon"></i>
              </span>
            </span>`;a.push(g)}else a.push(y);return!1});let u=l-i;u>0&&a.push(`<span class="vscomp-value-tag more-value-count">+ ${u} ${this.moreText}</span>`);let v=o.join(", ");if(v==="")r.innerHTML=this.placeholder;else if(r.innerHTML=v,e){let{maxValues:m}=this;if(x.hasEllipsis(r)||m||this.alwaysShowSelectedOptionsCount||s){let y=`<span class="vscomp-selected-value-count">${l}</span>`;if(m&&(y+=` / <span class="vscomp-max-value-count">${m}</span>`),h)r.innerHTML=`${this.allOptionsSelectedText} (${l})`;else if(s)r.innerHTML=a.join(""),this.$valueTags=r.querySelectorAll(".vscomp-value-tag"),this.setValueTagAttr();else{let g=l===1?this.optionSelectedText:this.optionsSelectedText;r.innerHTML=`${y} ${g}`}}else a=[]}}let p="";l===0?p=this.placeholder:s||(p=a.join(", ")),x.setData(r,"tooltip",p),e&&(x.setData(r,"tooltipEllipsisOnly",l===0),s&&this.updatePosition())}setSearchValue(e,t=!1,i=!1){if(e===this.searchValueOriginal&&!i)return;t||(this.$searchInput.value=e);let s=e.replace(/\\/g,"").toLowerCase().trim();this.searchValue=s,this.searchValueOriginal=e,x.toggleClass(this.$allWrappers,"has-search-value",e),this.afterSetSearchValue()}setVisibleOptionsCount(){let e=0,t=!1,i,{searchValue:s,searchGroup:r,showOptionsOnlyOnSearch:o,searchByStartsWith:a}=this,l=this.isOptionVisible.bind(this);this.hasOptionGroup&&(i=this.getVisibleOptionGroupsMapping(s)),this.options.forEach(c=>{if(c.isCurrentNew)return;let h;o&&!s?(c.isVisible=!1,h={isVisible:!1,hasExactOption:!1}):h=l({data:c,searchValue:s,hasExactOption:t,visibleOptionGroupsMapping:i,searchGroup:r,searchByStartsWith:a}),h.isVisible&&(e+=1),t||(t=h.hasExactOption)}),this.allowNewOption&&(s&&!t?(this.setNewOption(),e+=1):this.removeNewOption()),this.visibleOptionsCount=e,this.afterSetVisibleOptionsCount()}setOptionProp(e,t,i){!this.options[e]||(this.options[e][t]=i)}setOptionsHeight(){this.$optionsList.style.height=`${this.optionHeight*this.visibleOptionsCount}px`}setOptionsContainerHeight(e){let t;e?this.showAsPopup&&(this.optionsCount=this.getOptionsCount(),this.halfOptionsCount=Math.ceil(this.optionsCount/2),t=this.getOptionsHeight(),this.optionsHeight=t):(t=this.optionsHeight,this.keepAlwaysOpen&&(x.setStyle(this.$noOptions,"height",t),x.setStyle(this.$noSearchResults,"height",t))),x.setStyle(this.$optionsContainer,"max-height",t),this.afterSetOptionsContainerHeight(e)}setNewOption(e){let t=e||this.searchValueOriginal.trim();if(!t)return;let i=this.getNewOption();if(i){let s=i.index;this.setOptionProp(s,"value",this.secureText(t)),this.setOptionProp(s,"label",this.secureText(t))}else{let s={value:t,label:t};e?(s.isNew=!0,this.newValues.push(t)):s.isCurrentNew=!0,this.addOption(s)}}setSelectedProp(){let e={};this.selectedValues.forEach(t=>{e[t]=!0}),this.options.forEach(t=>{e[t.value]===!0&&(t.isSelected=!0)})}setNewOptionsFromValue(e){if(!e)return;let t=this.setNewOption.bind(this),i={};this.options.forEach(s=>{i[s.value]=!0}),e.forEach(s=>{s&&i[s]!==!0&&t(s)})}setDropboxWrapperWidth(){if(this.showAsPopup)return;let e=this.dropboxWidth||`${this.$wrapper.offsetWidth}px`;x.setStyle(this.$dropboxContainer,"max-width",e)}setEleStyles(){let{maxWidth:e}=this,t={};e&&(t["max-width"]=e),x.setStyles(this.$ele,t)}setDropboxStyles(){let{dropboxWidth:e}=this,t={},i={"z-index":this.zIndex};e&&(this.showAsPopup?t["max-width"]=e:i.width=e),x.setStyles(this.$dropboxContainer,i),x.setStyles(this.$dropbox,t)}setOptionAttr(){let{$visibleOptions:e}=this,{options:t}=this,i=`${this.optionHeight}px`,{setStyle:s,getData:r,setData:o}=x;e&&e.length&&e.forEach(a=>{let l=t[r(a,"index")];s(a,"height",i),o(a,"value",l.value)})}setValueTagAttr(){let{$valueTags:e}=this;if(!e||!e.length)return;let{getData:t,setData:i}=x,{options:s}=this;e.forEach(r=>{let o=t(r,"index");if(typeof o!="undefined"){let a=s[o];i(r,"value",a.value)}})}setScrollTop(){let{selectedValues:e}=this;if(this.showSelectedOptionsFirst||e.length===0)return;let t={},i;e.forEach(s=>{t[s]=!0}),this.options.some(s=>t[s.value]?(i=s.visibleIndex,!0):!1),i&&(this.$optionsContainer.scrollTop=this.optionHeight*i)}getVisibleOptions(){return this.visibleOptions||[]}getValue(){let e;return this.multiple?this.useGroupValue?e=this.getGroupValue():e=this.selectedValues:e=this.selectedValues[0]||"",e}getGroupValue(){let e=[],t={};return this.options.forEach(i=>{if(!i.isSelected)return;let{value:s}=i;i.isGroupTitle?s&&(t[i.index]=!0,e.push(s)):t[i.groupIndex]!==!0&&e.push(s)}),e}getInputValue(e){let t=e;return t&&t.length?this.setValueAsArray&&this.multiple&&(t=JSON.stringify(t)):t=this.emptyValue,t}getFirstVisibleOptionIndex(){return Math.ceil(this.$optionsContainer.scrollTop/this.optionHeight)}getVisibleStartIndex(){let t=this.getFirstVisibleOptionIndex()-this.halfOptionsCount;return t<0&&(t=0),t}getTooltipAttrText(e,t=!1,i=!1){let s={"data-tooltip":e||"","data-tooltip-enter-delay":this.tooltipEnterDelay,"data-tooltip-z-index":this.zIndex,"data-tooltip-font-size":this.tooltipFontSize,"data-tooltip-alignment":this.tooltipAlignment,"data-tooltip-max-width":this.tooltipMaxWidth,"data-tooltip-ellipsis-only":t,"data-tooltip-allow-html":i};return x.getAttributesText(s)}getOptionObj(e){if(!e)return;let{getString:t}=X,i=this.secureText.bind(this);return{index:e.index,value:i(t(e.value)),label:i(t(e.label)),description:i(t(e.description)),alias:this.getAlias(e.alias),isCurrentNew:e.isCurrentNew||!1,isNew:e.isNew||!1,isVisible:!0}}getNewOption(){let e=this.options[this.lastOptionIndex];if(!(!e||!e.isCurrentNew))return e}getOptionIndex(e){let t;return this.options.some(i=>i.value===e?(t=i.index,!0):!1),t}getNewValue(){let e={};this.newValues.forEach(i=>{e[i]=!0});let t=this.selectedValues.filter(i=>e[i]===!0);return this.multiple?t:t[0]}getAlias(e){let t=e;return t&&(Array.isArray(t)?t=t.join(","):t=t.toString().trim(),t=t.toLowerCase()),t||""}getDisplayValue(){let e=[];return this.options.forEach(t=>{t.isSelected&&e.push(t.label)}),this.multiple?e:e[0]||""}getSelectedOptions({fullDetails:e=!1,keepSelectionOrder:t=!1}={}){let{valueKey:i,labelKey:s,selectedValues:r}=this,o=[];if(this.options.forEach(a=>{if(a.isSelected&&!a.isGroupTitle)if(e)o.push(a);else{let l={[i]:a.value,[s]:a.label};a.isNew&&(l.isNew=!0),a.customData&&(l.customData=a.customData),o.push(l)}}),t){let a={};r.forEach((l,c)=>{a[l]=c}),o.sort((l,c)=>a[l.value]-a[c.value])}return this.multiple||e?o:o[0]}getVisibleOptionGroupsMapping(e){let{options:t}=this,i={},s=this.isOptionVisible.bind(this);return t=this.structureOptionGroup(t),t.forEach(r=>{i[r.index]=r.options.some(o=>s({data:o,searchValue:e}).isVisible)}),i}getOptionsCount(e){let t;if(this.showAsPopup){let i=window.innerHeight*80/100-io;this.hasSearchContainer&&(i-=no),t=Math.floor(i/this.optionHeight)}else t=parseInt(e);return t}getOptionsHeight(){return`${this.optionsCount*this.optionHeight}px`}getSibling(e,t){let i=t==="next"?"nextElementSibling":"previousElementSibling",s=e;do s&&(s=s[i]);while(x.hasClass(s,"disabled")||x.hasClass(s,"group-title"));return s}getUniqueId(){let e=X.getRandomInt(1e4);return document.querySelector(`#vscomp-ele-wrapper-${e}`)?this.getUniqueId():e}initDropboxPopover(){let e={ele:this.$ele,target:this.$dropboxContainer,position:this.position,zIndex:this.zIndex,margin:4,transitionDistance:30,hideArrowIcon:!0,disableManualAction:!0,disableUpdatePosition:!this.hasDropboxWrapper,updatePositionThrottle:this.updatePositionThrottle,afterShow:this.afterShowPopper.bind(this),afterHide:this.afterHidePopper.bind(this)};this.dropboxPopover=new PopoverComponent(e)}openDropbox(e){this.isSilentOpen=e,e?x.setStyle(this.$dropboxContainer,"display","inline-flex"):(x.dispatchEvent(this.$ele,"beforeOpen"),x.setAria(this.$wrapper,"expanded",!0)),this.setDropboxWrapperWidth(),x.removeClass(this.$allWrappers,"closed"),this.dropboxPopover&&!e?this.dropboxPopover.show():this.afterShowPopper()}afterShowPopper(){let e=this.isSilentOpen;this.isSilentOpen=!1,e||(this.moveSelectedOptionsFirst(),this.setScrollTop(),x.addClass(this.$allWrappers,"focused"),this.showAsPopup?(x.addClass(this.$body,"vscomp-popup-active"),this.isPopupActive=!0):this.focusSearchInput(),x.dispatchEvent(this.$ele,"afterOpen"))}closeDropbox(e){if(this.isSilentClose=e,this.keepAlwaysOpen){this.removeOptionFocus();return}e?x.setStyle(this.$dropboxContainer,"display",""):(x.dispatchEvent(this.$ele,"beforeClose"),x.setAria(this.$wrapper,"expanded",!1),x.setAria(this.$wrapper,"activedescendant","")),this.dropboxPopover&&!e?this.dropboxPopover.hide():this.afterHidePopper()}afterHidePopper(){let e=this.isSilentClose;this.isSilentClose=!1,x.removeClass(this.$allWrappers,"focused"),this.removeOptionFocus(),e||this.isPopupActive&&(x.removeClass(this.$body,"vscomp-popup-active"),this.isPopupActive=!1),x.addClass(this.$allWrappers,"closed"),e||x.dispatchEvent(this.$ele,"afterClose")}moveSelectedOptionsFirst(){!this.showSelectedOptionsFirst||(this.setSortedOptions(),!this.$optionsContainer.scrollTop||!this.selectedValues.length?this.setVisibleOptions():this.scrollToTop())}toggleDropbox(){this.isOpened()?this.closeDropbox():this.openDropbox()}updatePosition(){!this.dropboxPopover||this.$ele.updatePosition()}isOpened(){return!x.hasClass(this.$wrapper,"closed")}focusSearchInput(){let e=this.$searchInput;e&&e.focus()}focusOption({direction:e,$option:t,focusFirst:i}={}){let s=this.$dropboxContainer.querySelector(".vscomp-option.focused"),r;if(t)r=t;else if(!s||i){let o=this.getFirstVisibleOptionIndex();r=this.$dropboxContainer.querySelector(`.vscomp-option[data-visible-index="${o}"]`),(x.hasClass(r,"disabled")||x.hasClass(r,"group-title"))&&(r=this.getSibling(r,"next"))}else r=this.getSibling(s,e);r&&r!==s&&(s&&this.toggleOptionFocusedState(s,!1),this.toggleOptionFocusedState(r,!0),this.toggleFocusedProp(x.getData(r,"index"),!0),this.moveFocusedOptionToView(r))}moveFocusedOptionToView(e){let t=e||this.$dropboxContainer.querySelector(".vscomp-option.focused");if(!t)return;let i,s=this.$optionsContainer.getBoundingClientRect(),r=t.getBoundingClientRect(),o=s.top,a=s.bottom,l=s.height,c=r.top,h=r.bottom,p=r.height,d=t.offsetTop,u=x.getData(this.$options,"top","number");o>c?i=d+u:a<h&&(i=d-l+p+u),i!==void 0&&(this.$optionsContainer.scrollTop=i)}removeOptionFocus(){let e=this.$dropboxContainer.querySelector(".vscomp-option.focused");!e||(this.toggleOptionFocusedState(e,!1),this.toggleFocusedProp(null))}selectOption(e,{event:t}={}){if(!e)return;let i=!x.hasClass(e,"selected");if(i){if(this.multiple&&this.isMaxValuesSelected)return}else if(!this.multiple){this.closeDropbox();return}let{selectedValues:s}=this,r=x.getData(e,"value"),o=x.getData(e,"index","number"),a=!1,{lastSelectedOptionIndex:l}=this;if(this.lastSelectedOptionIndex=null,this.toggleSelectedProp(o,i),i){if(this.multiple)s.push(r),this.toggleAllOptionsClass(),this.toggleGroupOptionsParent(e),t&&t.shiftKey&&(a=!0);else{s.length&&this.toggleSelectedProp(this.getOptionIndex(s[0]),!1),s=[r];let c=this.$dropboxContainer.querySelector(".vscomp-option.selected");c&&this.toggleOptionSelectedState(c,!1),this.closeDropbox()}this.lastSelectedOptionIndex=o,this.toggleOptionSelectedState(e)}else this.multiple&&(this.toggleOptionSelectedState(e),X.removeItemFromArray(s,r),this.toggleAllOptionsClass(!1),this.toggleGroupOptionsParent(e,!1));x.hasClass(e,"current-new")&&this.beforeSelectNewValue(),this.setValue(s),a&&this.selectRangeOptions(l,o)}selectFocusedOption(){this.selectOption(this.$dropboxContainer.querySelector(".vscomp-option.focused"))}selectRangeOptions(e,t){if(typeof e!="number"||this.maxValues)return;let{selectedValues:i,hasOptionGroup:s}=this,r={},o,a;if(e<t?(o=e,a=t):(o=t,a=e),this.options.forEach(l=>{if(l.isDisabled||l.isGroupTitle||!l.isVisible||l.isSelected)return;let{index:c}=l;if(c>o&&c<a){if(s){let{groupIndex:h}=l;typeof h=="number"&&(r[h]=!0)}l.isSelected=!0,i.push(l.value)}}),this.toggleAllOptionsClass(),this.setValue(i),r=Object.keys(r),r.length){let l=this.toggleGroupTitleProp.bind(this);r.forEach(c=>{l(parseInt(c))})}setTimeout(()=>{this.renderOptions()},0)}toggleAllOptions(e){if(!this.multiple||this.disableSelectAll)return;typeof e!="boolean"&&(e=!x.hasClass(this.$toggleAllCheckbox,"checked"));let t=[],{selectAllOnlyVisible:i}=this;this.options.forEach(s=>{s.isDisabled||s.isCurrentNew||(!e||i&&!s.isVisible?s.isSelected=!1:(s.isSelected=!0,s.isGroupTitle||t.push(s.value)))}),this.toggleAllOptionsClass(e),this.setValue(t),this.renderOptions()}toggleAllOptionsClass(e){if(!this.multiple)return;let t=typeof e=="boolean";t||(e=this.isAllOptionsSelected()),x.toggleClass(this.$toggleAllCheckbox,"checked",e),this.selectAllOnlyVisible&&t?this.isAllSelected=this.isAllOptionsSelected():this.isAllSelected=e}isAllOptionsSelected(){let e=!1;return this.options.length&&this.selectedValues.length&&(e=!this.options.some(t=>!t.isSelected&&!t.isDisabled&&!t.isGroupTitle)),e}isAllGroupOptionsSelected(e){let t=!1;return this.options.length&&(t=!this.options.some(i=>!i.isSelected&&!i.isDisabled&&!i.isGroupTitle&&i.groupIndex===e)),t}toggleGroupOptionsParent(e,t){if(!this.hasOptionGroup||this.disableOptionGroupCheckbox||!e)return;let i=x.getData(e,"groupIndex","number"),s=this.$options.querySelector(`.vscomp-option[data-index="${i}"]`),r=typeof t=="boolean"?t:this.isAllGroupOptionsSelected(i);this.toggleGroupTitleCheckbox(s,r)}toggleGroupTitleProp(e,t){let i=typeof t=="boolean"?t:this.isAllGroupOptionsSelected(e);this.toggleSelectedProp(e,i)}toggleGroupOptions(e,t){if(!this.hasOptionGroup||this.disableOptionGroupCheckbox||!e)return;let i=x.getData(e,"index","number"),{selectedValues:s,selectAllOnlyVisible:r}=this,o={},{removeItemFromArray:a}=X;s.forEach(l=>{o[l]=!0}),this.options.forEach(l=>{if(l.isDisabled||l.groupIndex!==i)return;let{value:c}=l;!t||r&&!l.isVisible?(l.isSelected=!1,o[c]&&a(s,c)):(l.isSelected=!0,o[c]||s.push(c))}),this.toggleAllOptionsClass(t?null:!1),this.setValue(s),setTimeout(()=>{this.renderOptions()},0)}toggleGroupTitleCheckbox(e,t){if(!e)return;let i=x.getData(e,"index","number");this.toggleSelectedProp(i,t),this.toggleOptionSelectedState(e,t)}toggleFocusedProp(e,t=!1){this.focusedOptionIndex&&this.setOptionProp(this.focusedOptionIndex,"isFocused",!1),this.setOptionProp(e,"isFocused",t),this.focusedOptionIndex=e}toggleSelectedProp(e,t=!1){this.setOptionProp(e,"isSelected",t)}scrollToTop(){let e=!this.isOpened();e&&this.openDropbox(!0);let{scrollTop:t}=this.$optionsContainer;t>0&&(this.$optionsContainer.scrollTop=0),e&&this.closeDropbox(!0)}reset(e=!1){this.options.forEach(t=>{t.isSelected=!1}),this.beforeValueSet(!0),this.setValue(null,{disableValidation:e}),this.afterValueSet(),e&&x.removeClass(this.$allWrappers,"has-error"),x.dispatchEvent(this.$ele,"reset")}addOption(e,t){if(!e)return;this.lastOptionIndex+=1;let i=this.getOptionObj(Y(K({},e),{index:this.lastOptionIndex}));this.options.push(i),this.sortedOptions.push(i),t&&(this.visibleOptionsCount+=1,this.afterSetOptions())}removeOption(e){!e&&e!==0||(this.options.splice(e,1),this.lastOptionIndex-=1)}removeNewOption(){let e=this.getNewOption();e&&this.removeOption(e.index)}sortOptions(e){return e.sort((t,i)=>{let s=t.isSelected||t.isAnySelected,r=i.isSelected||i.isAnySelected;return!s&&!r?0:s&&(!r||t.index<i.index)?-1:1})}sortOptionsGroup(e){let t=this.sortOptions.bind(this),i=this.structureOptionGroup(e);return i.forEach(s=>{let r=s.options;s.isAnySelected=r.some(o=>o.isSelected),s.isAnySelected&&t(r)}),t(i),this.destructureOptionGroup(i)}isOptionVisible({data:e,searchValue:t,hasExactOption:i,visibleOptionGroupsMapping:s,searchGroup:r,searchByStartsWith:o}){let a=e.value.toLowerCase(),l=e.label.toLowerCase(),{description:c,alias:h}=e,p=o?l.startsWith(t):l.indexOf(t)!==-1;return e.isGroupTitle&&(!r||!p)&&(p=s[e.index]),!o&&h&&!p&&(p=h.indexOf(t)!==-1),!o&&c&&!p&&(p=c.toLowerCase().indexOf(t)!==-1),e.isVisible=p,i||(i=l===t||a===t),{isVisible:p,hasExactOption:i}}structureOptionGroup(e){let t=[],i={};return e.forEach(s=>{if(s.isGroupTitle){let r=[];s.options=r,i[s.index]=r,t.push(s)}}),e.forEach(s=>{s.isGroupOption&&i[s.groupIndex].push(s)}),t}destructureOptionGroup(e){let t=[];return e.forEach(i=>{t.push(i),t=t.concat(i.options)}),t}serverSearch(){x.removeClass(this.$allWrappers,"has-no-search-results"),x.addClass(this.$allWrappers,"server-searching"),this.setSelectedOptions(),this.onServerSearch(this.searchValue,this)}removeValue(e){let{selectedValues:t}=this,i=x.getData(e,"value");X.removeItemFromArray(t,i),this.setValueMethod(t)}focus(){this.$wrapper.focus()}enable(){this.$ele.disabled=!1,this.$ele.removeAttribute("disabled"),this.$hiddenInput.removeAttribute("disabled"),x.setAria(this.$wrapper,"disabled",!1)}disable(){this.$ele.disabled=!0,this.$ele.setAttribute("disabled",""),this.$hiddenInput.setAttribute("disabled",""),x.setAria(this.$wrapper,"disabled",!0)}validate(){if(this.disableValidation)return!0;let e=!1;return this.required&&X.isEmpty(this.selectedValues)&&(e=!0),x.toggleClass(this.$allWrappers,"has-error",e),!e}destroy(){let{$ele:e}=this;e.virtualSelect=void 0,e.value=void 0,e.innerHTML="",this.hasDropboxWrapper&&(this.$dropboxWrapper.remove(),this.mutationObserver.disconnect()),this.dropboxPopover&&this.dropboxPopover.destroy(),x.removeClass(e,"vscomp-ele")}createSecureTextElements(){this.$secureDiv=document.createElement("div"),this.$secureText=document.createTextNode(""),this.$secureDiv.appendChild(this.$secureText)}secureText(e){return!e||!this.enableSecureText?e:(this.$secureText.nodeValue=e,this.$secureDiv.innerHTML)}toggleRequired(e){this.required=X.convertToBoolean(e),this.$ele.required=this.required}toggleOptionSelectedState(e,t){let i=t;typeof i=="undefined"&&(i=!x.hasClass(e,"selected")),x.toggleClass(e,"selected",i),x.setAria(e,"selected",i)}toggleOptionFocusedState(e,t){!e||(x.toggleClass(e,"focused",t),t&&x.setAria(this.$wrapper,"activedescendant",e.id))}static init(e){let t=e.ele;if(!t)return;let i=!1;if(typeof t=="string"){t=document.querySelectorAll(t);let r=t.length;if(r===0)return;r===1&&(i=!0)}(t.length===void 0||t.forEach===void 0)&&(t=[t],i=!0);let s=[];return t.forEach(r=>{if(r.virtualSelect){s.push(r.virtualSelect);return}e.ele=r,r.tagName==="SELECT"&&V.setPropsFromSelect(e),s.push(new V(e))}),i?s[0]:s}static getAttrProps(){let{convertPropToDataAttr:e}=x,t={};return ro.forEach(i=>{t[i]=i}),oo.forEach(i=>{t[e(i)]=i}),t}static setPropsFromSelect(e){let t=e.ele,i=[],s=[],r=l=>{let c=[];return Array.from(l.children).forEach(p=>{let{value:d}=p,u={value:d};p.tagName==="OPTGROUP"?(u.label=p.getAttribute("label"),u.options=r(p)):u.label=p.innerHTML,c.push(u),p.disabled&&i.push(d),p.selected&&s.push(d)}),c},o=r(t),a=document.createElement("div");x.setAttrFromEle(t,a,Object.keys(Zt),ps),t.parentNode.insertBefore(a,t),t.remove(),e.ele=a,e.options=o,e.disabledOptions=i,e.selectedValue=s}static onFormReset(e){let t=e.target.closest("form");!t||t.querySelectorAll(".vscomp-ele-wrapper").forEach(i=>{i.parentElement.virtualSelect.reset(!0)})}static onFormSubmit(e){V.validate(e.target.closest("form"))||e.preventDefault()}static validate(e){if(!e)return!0;let t=!1;return e.querySelectorAll(".vscomp-ele-wrapper").forEach(i=>{let s=i.parentElement.virtualSelect.validate();!t&&!s&&(t=!0)}),!t}static reset(){this.virtualSelect.reset()}static setValueMethod(...e){this.virtualSelect.setValueMethod(...e)}static setOptionsMethod(...e){this.virtualSelect.setOptionsMethod(...e)}static setDisabledOptionsMethod(...e){this.virtualSelect.setDisabledOptionsMethod(...e)}static toggleSelectAll(e){this.virtualSelect.toggleAllOptions(e)}static isAllSelected(){return this.virtualSelect.isAllSelected}static addOptionMethod(e){this.virtualSelect.addOption(e,!0)}static getNewValueMethod(){return this.virtualSelect.getNewValue()}static getDisplayValueMethod(){return this.virtualSelect.getDisplayValue()}static getSelectedOptionsMethod(e){return this.virtualSelect.getSelectedOptions(e)}static openMethod(){return this.virtualSelect.openDropbox()}static closeMethod(){return this.virtualSelect.closeDropbox()}static focusMethod(){return this.virtualSelect.focus()}static enableMethod(){return this.virtualSelect.enable()}static disableMethod(){return this.virtualSelect.disable()}static destroyMethod(){return this.virtualSelect.destroy()}static validateMethod(){return this.virtualSelect.validate()}static toggleRequiredMethod(e){return this.virtualSelect.toggleRequired(e)}static onResizeMethod(){document.querySelectorAll(".vscomp-ele-wrapper").forEach(e=>{e.parentElement.virtualSelect.onResize()})}};document.addEventListener("reset",V.onFormReset);document.addEventListener("submit",V.onFormSubmit);window.addEventListener("resize",V.onResizeMethod);Zt=V.getAttrProps();window.VirtualSelect=V;typeof NodeList!="undefined"&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var ti=require("obsidian");gs();bs();var Me=class extends ti.ItemView{constructor(t,i){super(t);this.cache=i;this.MENTION_SELECT_ID="mention-select";this.MENTION_VIEW_SELECT_CONTAINER="mention-view-select-container";this.mentionSelectValue="";this.includeCompleted=!1;this.occurences=[];this.initRender(),this.onActiveLeafChangeEventRef=this.app.workspace.on("active-leaf-change",s=>{s.view instanceof Me&&this.renderMentionSelect()}),this.onunload=()=>{this.app.workspace.offref(this.onActiveLeafChangeEventRef)}}get mentionSelectElement(){return document.querySelector(`#${this.MENTION_SELECT_ID}`)}getViewType(){return ce}getDisplayText(){return"Mention"}getIcon(){return"at"}updateList(t,i){(this.mentionSelectValue===t.name||this.occurences.map(s=>s.path).includes(i))&&this.renderOccurencesList()}selectMentionByKey(t){return D(this,null,function*(){this.app.workspace.revealLeaf(this.leaf),yield this.renderMentionSelect(),this.mentionSelectElement.setValue(t)})}initRender(){return D(this,null,function*(){this.renderContainers(),this.renderControlls()})}renderContainers(){this.viewContent=this.containerEl.children[1],this.viewContent.empty(),this.container=this.viewContent.createDiv("mention-view-container"),this.controlsContainer=this.container.createDiv("mention-view-controls-container"),this.listContainer=this.container.createDiv("mention-view-list-container")}renderControlls(){this.controlsContainer.empty(),this.renderSelectContainer(),this.renderSimpleFilter(),this.renderIncludeComplededTasksCheckbox()}renderSelectContainer(){this.controlsContainer.createDiv(this.MENTION_VIEW_SELECT_CONTAINER,t=>{t.id=this.MENTION_VIEW_SELECT_CONTAINER})}renderSimpleFilter(){this.controlsContainer.createDiv("mention-view-simplefilter",t=>{this.simpleFilterInput=document.createElement("input"),this.simpleFilterInput.addClass("simplefilter"),this.simpleFilterInput.setAttr("type","text"),this.simpleFilterInput.placeholder="Filter...",this.simpleFilterInput.addEventListener("keyup",i=>{this.renderOccurencesList()}),t.appendChild(this.simpleFilterInput)})}renderIncludeComplededTasksCheckbox(){this.controlsContainer.createDiv("mention-view-includeCompleted",t=>{this.includeCompletedLabel=document.createElement("div"),this.includeCompletedLabel.innerText="Include completed tasks",this.includeCompletedCheckbox=document.createElement("div"),this.includeCompletedCheckbox.addClass("checkbox-container"),this.includeCompletedCheckbox.addEventListener("click",i=>{this.includeCompleted=!this.includeCompleted,this.includeCompletedCheckbox.toggleClass("is-enabled",this.includeCompleted),this.renderOccurencesList()}),t.appendChild(this.includeCompletedLabel),t.appendChild(this.includeCompletedCheckbox)})}renderOccurencesList(){this.listContainer.empty(),this.listContainer.createDiv("mention-view-item-list",t=>D(this,null,function*(){var i;this.occurences=yield this.cache.getOccurencesByMention(this.mentionSelectValue),this.occurences.length>0&&(this.occurences=[...new Map(this.occurences.map(s=>[s.path+":"+s.lineFrom+":"+s.lineTo,s])).values()],(i=this.occurences)==null||i.sort(this.occurenceComparer).forEach(s=>{this.filterAndRenderMentions(s,t)})),this.occurences.length===0&&this.mentionSelectValue!=""&&t.createDiv("mention-view-item-list-empty",s=>{s.innerText="No occurences to show"})}))}filterAndRenderMentions(t,i){!this.includeCompleted&&t.isTaskComplete||(this.simpleFilterInput.value==null||this.simpleFilterInput.value!=null&&t.text.toLocaleLowerCase().contains(this.simpleFilterInput.value.toLocaleLowerCase()))&&this.renderOccurence(i,t)}renderOccurence(t,i){t.createDiv("mention-view-item",s=>{ti.MarkdownRenderer.renderMarkdown(i.text.trimStart(),s,i.path,this),this.registerTodoCheckboxClick(s,i),this.registerItemClick(s,i),s.createDiv("mention-view-item-file",r=>{r.innerText=i.path})})}registerTodoCheckboxClick(t,i){var s;(s=t.getElementsByTagName("input")[0])==null||s.addEventListener("input",r=>D(this,null,function*(){let o=`
`,a=r.target.checked,l=this.app.vault.getAbstractFileByPath(i.path),h=(yield this.app.vault.read(l)).split(o);h[i.lineNumber-1]=h[i.lineNumber-1].replace(rs,`${a?"[x]":"[ ]"}`),this.app.vault.modify(l,h.join(o)),r.stopPropagation()}))}registerItemClick(t,i){t.onClickEvent(s=>D(this,null,function*(){let r=this.app.vault.getAbstractFileByPath(i.path),o=this.app.workspace,a=yield this.app.vault.read(r);o.getLeaf(o.getActiveFile()&&o.getActiveFile().path!==i.path).openFile(r,{active:!0,eState:{match:{content:a,matches:[[i.lineFrom+i.startOccurence,i.lineFrom+i.endOccurence]]}}})}))}renderMentionSelect(){return D(this,null,function*(){document.getElementById(this.MENTION_SELECT_ID)==null&&(this.addMentionSelectElement(),V.init({ele:`#${this.MENTION_SELECT_ID}`,options:yield this.getMentionSelectOptions(),search:!0,markSearchResults:!0}),this.mentionSelectElement.addEventListener("beforeOpen",()=>D(this,null,function*(){return yield this.handleMentionSelectBeforeOpen()})),this.mentionSelectElement.addEventListener("change",()=>this.handleMentionSelectChange()))})}addMentionSelectElement(){let t=document.getElementById(this.MENTION_VIEW_SELECT_CONTAINER),i=t.createDiv();i.id=this.MENTION_SELECT_ID,t.appendChild(i)}getMentionSelectOptions(){return D(this,null,function*(){return(yield this.cache.getAllMentions()).map(i=>({label:i,value:i})).sort(this.mentionLabelComparer)})}handleMentionSelectBeforeOpen(){return D(this,null,function*(){this.mentionSelectElement.setOptions(yield this.getMentionSelectOptions(),!0)})}handleMentionSelectChange(){let t=this.mentionSelectElement.value;this.mentionSelectValue=t!=null?t:"",this.renderOccurencesList()}occurenceComparer(t,i){return t.path===i.path?t.lineNumber-i.lineNumber:t.path>i.path?1:-1}mentionLabelComparer(t,i){return t.label.toLowerCase()<i.label.toLowerCase()?-1:t.label.toLowerCase()>i.label.toLowerCase()?1:0}};var be=require("obsidian"),Ne={mentionTriggerPhrase:"@",mentionStyleColor:"green",meMentionName:"Me",meMentionStyleColor:"deeppink",ignoredDirectories:""};function un(n){let e=n.ignoredDirectories.split(",");e.forEach((t,i)=>{t=t.trim(),!t.endsWith("/")&&t!=""&&(t=t+"/ "),e[i]=t}),n.ignoredDirectories=e.join(",")}var ii=class extends be.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),new be.Setting(t).setName("Mention trigger").setDesc("Leave this blank if you want to use the default value (@). Please reload Obsidian after changing this value.").addText(i=>{i.setPlaceholder("@"),i.setValue(this.plugin.settings.mentionTriggerPhrase).onChange(s=>{this.plugin.settings.mentionTriggerPhrase=s,s===""&&(this.plugin.settings.mentionTriggerPhrase=Ne.mentionTriggerPhrase),this.plugin.saveSettings()})}),new be.Setting(t).setName("Mention style color").setDesc("Default/empty is green. You can insert a Hex (#00ff00) or a CSS color (green).").addText(i=>{i.setPlaceholder("green"),i.setValue(this.plugin.settings.mentionStyleColor).onChange(s=>{this.plugin.settings.mentionStyleColor=s,s===""&&(this.plugin.settings.mentionStyleColor=Ne.mentionStyleColor),this.plugin.saveSettings()})}),new be.Setting(t).setName("Mention yourself").setDesc('Default/empty is "Me" (@Me). Please reload Obsidian after changing this value.').addText(i=>{i.setPlaceholder("Me"),i.setValue(this.plugin.settings.meMentionName).onChange(s=>{this.plugin.settings.meMentionName=s,s===""&&(this.plugin.settings.meMentionName=Ne.meMentionName),this.plugin.saveSettings()})}),new be.Setting(t).setName("Mention yourself style color").setDesc("Default/empty is deeppink. You can insert a Hex (#FF1493) or a CSS color (deeppink).").addText(i=>{i.setPlaceholder("deeppink"),i.setValue(this.plugin.settings.meMentionStyleColor).onChange(s=>{this.plugin.settings.meMentionStyleColor=s,s===""&&(this.plugin.settings.meMentionStyleColor=Ne.meMentionStyleColor),this.plugin.saveSettings()})}),new be.Setting(t).setName("Ignored directories").setDesc("List of directories to ignore (separated by comma). Please reload Obsidian after changing this value.").addText(i=>{i.setValue(this.plugin.settings.ignoredDirectories).onChange(s=>{this.plugin.settings.ignoredDirectories=s,s===""&&(this.plugin.settings.ignoredDirectories=Ne.ignoredDirectories),this.plugin.saveSettings()})}),new be.Setting(t).setName("Delete cache").setDesc("All cache related data is deleted and will be recreated after reloading Obsidian. Please reload Obsidian after deleting.").addButton(i=>{i.setButtonText("Delete cache"),i.onClick(s=>{this.plugin.deleteCache()})})}};var ni=class{constructor(e){this.settings=e;this.style=document.createElement("style")}appendStyle(){let e=`
            :root {
                --mention_color: ${this.settings.mentionStyleColor};
                --me_mention_color: ${this.settings.meMentionStyleColor};
            }

            .me_mention {
                color: var(--me_mention_color);
                border: 1px var(--me_mention_color) solid;
                border-radius: 5px;
                padding: 0px .2em 0px 0.05em;
                text-decoration: none;
            }

            .me_mention.preview:hover {
                filter:brightness(130%);
                color: var(--me_mention_color);
                cursor: pointer;
            }

            .mention {
                color: var(--mention_color);
                border: 1px var(--mention_color) solid;
                border-radius: 5px;
                padding: 0px .2em 0px 0.05em;
                text-decoration: none;
            }

            .mention.preview:hover {
                filter:brightness(130%);
                color: var(--mention_color);
                cursor: pointer;
            }

            .mention-view-item {
                cursor: pointer;
                border-radius: 3px;
                position: relative;
                white-space: pre-wrap;
                color: var(--text-normal);
                background: var(--background-search-result);
                padding: 3px 9px;
                margin-bottom: 10px;
            }

            .mention-view-item-list-empty {
                border-top: 1px solid;
                position: relative;
                white-space: pre-wrap;
                color: var(--text-normal);
                padding: 3px 9px;
                filter: brightness(0.5);
            }

            .mention-view-item ul {
                margin-block-start: 0px;
                margin-block-end: 0px;
                line-height: normal;
            }

            .mention-view-item-file {
                font-size: 0.8em;
                border-top: solid 1px;
                filter: brightness(0.5);
            }

            .mention-view-controls-container {
                padding: 0px 0px 20px 0px;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .mention-view-select select {
                width: 100%;
            }

            .mention-view-simplefilter input {
                width: 100%;
            }

            .mention-view-includeCompleted {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        `;this.style.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(this.style)}removeStyle(){document.getElementsByTagName("head")[0].removeChild(this.style)}updateStyle(){this.removeStyle(),this.appendStyle()}};var Qa=require("electron"),si=class extends ri.Plugin{onload(){return D(this,null,function*(){yield this.loadSettings(),un(this.settings),this.addAtIcon(),this.addStyle(),this.cache=new Ut(this.app.metadataCache,this.app.vault,this.settings),this.registerView(ce,t=>{let i=new Me(t,this.cache);return this.cache.subscribeToOccurencesChanges(i.updateList.bind(i)),i}),this.app.workspace.layoutReady?this.initAfterLayoutReady():this.app.workspace.onLayoutReady(()=>D(this,null,function*(){this.initAfterLayoutReady()})),this.addSettingTab(new ii(this.app,this))})}initAfterLayoutReady(){try{this.cache.init()}catch(t){console.error(t)}this.initMentionView(),this.registerMarkdownPostProcessor((t,i)=>{let s=new Xt(t,this.settings,i);s.addPreviewMentionStyle(),s.subscribeToMentionClick(this.previewClickHandler.bind(this))}),this.registerEditorExtension(us(this.app,{regexp:zt(this.settings.mentionTriggerPhrase,this.settings.meMentionName),keyDownHandler:this.searchForMention.bind(this),mouseDownHandler:this.searchForMention.bind(this)},this.settings)),this.registerEditorSuggest(new Qt(this.app,this.cache,this.settings))}initMentionView(){this.app.workspace.getLeavesOfType(ce).length||this.app.workspace.getRightLeaf(!1).setViewState({type:ce})}onunload(){this.cache.unsubscribeAll(),this.cache.unload(),this.style!=null&&this.style.removeStyle(),this.app.workspace.getLeavesOfType,this.app.workspace.detachLeavesOfType(ce)}loadSettings(){return D(this,null,function*(){this.settings=Object.assign({},Ne,yield this.loadData())})}saveSettings(){return D(this,null,function*(){yield this.saveData(this.settings),un(this.settings),this.style.updateStyle()})}deleteCache(){this.cache.deleteDb()}addAtIcon(){let t=hs();(0,ri.addIcon)(t.iconId,t.svgContent)}addStyle(){this.style=new ni(this.settings),this.style.appendStyle()}previewClickHandler(t){return D(this,null,function*(){yield this.activateMentionView(),this.app.workspace.getActiveViewOfType(Me).selectMentionByKey(t.replace(this.settings.mentionTriggerPhrase,""))})}searchForMention(t,i,s){return D(this,null,function*(){yield this.activateMentionView(),this.app.workspace.getActiveViewOfType(Me).selectMentionByKey(yield this.cache.getMentionAt(s,t,i))})}activateMentionView(){return D(this,null,function*(){this.app.workspace.detachLeavesOfType(ce),yield this.app.workspace.getRightLeaf(!1).setViewState({type:ce,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(ce)[0])})}};
